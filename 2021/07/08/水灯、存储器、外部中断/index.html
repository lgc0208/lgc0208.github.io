<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="记录学业和生活" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>流水灯、存储器、外部中断实验 |  梦</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/images/sun-side.svg" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="梦" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-水灯、存储器、外部中断"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  流水灯、存储器、外部中断实验
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/" class="article-date">
  <time datetime="2021-07-07T16:10:46.000Z" itemprop="datePublished">2021-07-08</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a> / <a class="article-category-link" href="/categories/%E9%A1%B9%E7%9B%AE/C/">C</a> / <a class="article-category-link" href="/categories/%E9%A1%B9%E7%9B%AE/%E6%B1%87%E7%BC%96/">汇编</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">9.2k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">41 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <p>计算机原理与应用实验-流水灯、存储器、外部中断实验</p>
<span id="more"></span>
<h1 id="1-实验一-流水灯实验"><a href="#1-实验一-流水灯实验" class="headerlink" title="1 实验一 流水灯实验"></a>1 实验一 流水灯实验</h1><h2 id="1-1-实验目的"><a href="#1-1-实验目的" class="headerlink" title="1.1 实验目的"></a>1.1 实验目的</h2><ol>
<li><p>掌握ARM开发工具的使用。</p>
</li>
<li><p>掌握基本IO的使用。</p>
</li>
</ol>
<h2 id="1-2-实验原理及内容"><a href="#1-2-实验原理及内容" class="headerlink" title="1.2 实验原理及内容"></a>1.2 实验原理及内容</h2><ol>
<li><strong>电路结构图</strong></li>
</ol>
<p>实现流水灯的电路结构图如图1所示。以两条红色虚线为界，从左至右第一部分为ARM系统部分，第三部分为外围电路，第二部分是接口部分，需要自己将其连接。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707225257418.png" alt=" "></p>
<center> 图 1 流水灯的电路结构图 </center>


<p>接线方式为：GPIOF_0~GPIOF_7（P12接口）接LED1~LED8（P2接口）。</p>
<ol>
<li><strong>LED电路原理</strong></li>
</ol>
<p>LED灯的驱动原理如图2所示。当发光二极管正向导通时，LED灯点亮。    </p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707225607582.png" alt=" "></p>
<center> 图 2 LED灯正向导通</center>

<p>如图3所示，LED灯与MCU引脚连接，MCU IO额定电流为25mA，例如0603封装红色LED灯额定电流为20mA，已经接近MCU IO的额定电流，可能会损毁器件。因此图1.3微控制器驱动LED灯方案不可取。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707230556740.png" alt=" "></p>
<center> 图 3 微控制器驱动 LED 灯</center>

<p>实际微控制驱动LED灯的电路模型包括：控制器、驱动器和执行器三部分，控制器提供控制信号，再由驱动器驱动执行器，如图4所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707230939893.png" alt=" "></p>
<center> 图 4 LED 灯去驱动电路模型</center>



<p>如图5所示LED灯通过N沟道MOS管驱动，MCU IO输出高电平时MOS管漏极和源极导通LED灯被点亮，反之MCU输出低电平时MOS管漏极和源极截止，LED灯不能被点亮。假设VCC电压3.3V，MOS管导通阻值为零，通过LED灯的电流将远超额定电流出现短路现象，故此方案不可取。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707234219270.png" alt=" "></p>
<center> 图 5 MOS 管驱动 LED 灯电路</center>

<p>如图6所示，LED驱动电路中增加电阻（R），以此保证通过LED灯的电流不超过额定电流，避免损坏器件，故将电阻R称为限流电阻。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707234307889.png" alt=" "></p>
<center> 图 6 限流电阻</center>



<p>如图7所示LED电路原理图，R1位置电阻作为限流电阻，R29位置电阻作为下拉电阻，避免MOS管栅极出现亚稳态。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707234335315.png" alt=" "></p>
<center> 图 7 LED 电路原理图</center>


<ol>
<li><strong>微控制器IO输出控制原理</strong></li>
</ol>
<p>如图8所示，基本结构针对STM32F407有7组IO。分别为GPIOA~GPIOG，每组IO有16个IO口，则有112个IO口。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-164387143066830.png" alt=" "></p>
<center> 图 8 I/O 端口位控制基本结构</center>



<p>STM32F4的GPIO工作方式有8种，其中4种输入，4种输出，分别为：输入浮空、输入上拉、输入下拉、模拟模式、开漏输出、开漏复用输出、推挽输出、推挽复用输出。</p>
<p>（i）输入方式</p>
<p>浮空即电路既不上拉也不下拉，直接通过施密特触发器送到输入数据寄存器再送入到CPU；上拉或下拉方式间接通过上拉或下拉电阻后再通过施密特触发器送到输入数据寄存器最后送入到CPU；模拟方式是关闭施密特触发器后信号直接通过模拟通道至片上外设。</p>
<p>（ii）输出方式</p>
<p>开漏输出指CPU直接或间接地把数据输出到数据寄存器，然后通过输出控制电路来决定最后的输出信号电平。当信号为1时，N—MOS管关闭，IO电平受上下拉电路的控制；当信号为0时，N—MOS管导通，输出下拉低电平。推挽输出方式时，当信号为1时，P-MOS管导通，N-MOS管截止，输出上拉高电平；当信号为0时，P-MOS管截止，N-MOS管导通，输出下拉低电平。开漏复用和推挽复用方式与开漏和推挽的区别是信号来源不同。开漏复用和推挽复用的信号来源是片上的外设模块。</p>
<p>（iii）IO的相关寄存器</p>
<p>每个通用的IO端口都包含4个32位的配置寄存器（GPIOx_MODER、GPIOx_OTYPER、PIOx_OSPEEDR和GPIOx_PUPDR）。2个32位的数据寄存器（GPIOx_IDR和GPIOx_ODR），1个32位置位/复位寄存器（GPIOx_BSRR），1个32位锁定寄存器（GPIOx_LCKR）和2个32位复用功能选择寄存器（GPIOx_AFRL）。</p>
<p>（iv）工作方式配置</p>
<p>端口方式配置寄存器（GPIOx_MODER）用来配置端口的输入、输出、复用和模拟方式；端口输出方式配置寄存器（GPIOx_OTYPER）用来配置端口输出为推挽还是开漏；端口速度配置寄存器（PIOx_OSPEEDR）用来配置端口的信息传输速率；端口上下拉配置寄存器（GPIOx_PUPDR）用来配置端口的无上下拉、上拉、下拉和保留方式。</p>
<p>（v）数据寄存器配置</p>
<p>端口输入数据寄存器（GPIOx_IDR）用到低16位，分别对应该组IO口的一个电平状态。端口输出数据寄存器（GPIOx_ODR）用到低16位，分别对应该组IO口的一个电平状态。置位和复位寄存器（GPIOx_BSRR）与前两个不同的，置位和复位寄存器用到了32位。低16为设置为1时，用于置1对应位。高16位设置为1时，用于置0对应位。而低16位和高16位设置为0时不影响原值。</p>
<h2 id="1-3-完整的硬件接线图和软件程序流程图"><a href="#1-3-完整的硬件接线图和软件程序流程图" class="headerlink" title="1.3 完整的硬件接线图和软件程序流程图"></a>1.3 完整的硬件接线图和软件程序流程图</h2><ol>
<li><strong>硬件接线图</strong></li>
</ol>
<p>实现流水灯的电路结构图如图1所示。以两条红色虚线为界，从左至右第一部分为ARM系统部分，第三部分为外围电路，第二部分是接口部分，需要自己将其连接。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707234455340.png" alt=" "></p>
<center> 图 9 流水灯的硬件接线图</center>

<p>接线方式为：GPIOF_0~GPIOF_7（P12接口）接LED1~LED8（P2接口）。</p>
<ol>
<li><strong>软件程序流程图</strong></li>
</ol>
<p>实现流水灯的软件流程图如图10所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-164387142237627.png" alt=" "></p>
<center> 图 10 流水灯的软件流程图</center>


<h2 id="1-4-流水灯源程序代码"><a href="#1-4-流水灯源程序代码" class="headerlink" title="1.4 流水灯源程序代码"></a>1.4 流水灯源程序代码</h2><ol>
<li><strong>main.c</strong></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/************************************************************* </span></span><br><span class="line"><span class="comment">实验名称：LED流水灯 </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">硬件模块：计算机原理应用试验箱 </span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">硬件接线：P12~P2 </span></span><br><span class="line"><span class="comment">           </span></span><br><span class="line"><span class="comment">实验现象：通过数据移位操作，LED1~LED8实现流水灯效果 </span></span><br><span class="line"><span class="comment">**************************************************************/</span>  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f4xx.h&quot;</span>  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span>  </span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">uint8_t</span>  cont = <span class="number">128</span>;  </span><br><span class="line">    <span class="keyword">uint16_t</span> led_data = <span class="number">0</span>;  </span><br><span class="line">    GPIO_InitTypeDef   GPIO_InitStructure;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//  开启GPIO时钟  </span></span><br><span class="line">    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOF, ENABLE);     </span><br><span class="line">  </span><br><span class="line">    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_All;  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 输出模式  </span></span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;          </span><br><span class="line">    <span class="comment">// 设置推挽输出  </span></span><br><span class="line">        GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;           </span><br><span class="line">        <span class="comment">// 速率25MHZ  </span></span><br><span class="line">    GPIO_InitStructure.GPIO_Speed = GPIO_Medium_Speed;       </span><br><span class="line">    GPIO_Init(GPIOF, &amp;GPIO_InitStructure);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    GPIO_Write(GPIOF, <span class="number">0x00FF</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 初始化延时  </span></span><br><span class="line">    Delay_Init();     </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)  </span><br><span class="line">    &#123;  </span><br><span class="line">        led_data = <span class="number">128</span>&lt;&lt;cont;           </span><br><span class="line">        GPIO_Write(GPIOF, led_data);   </span><br><span class="line">        Delay_Ms(<span class="number">100</span>);  </span><br><span class="line">        cont++;  </span><br><span class="line">                <span class="comment">// 大于7后清零  </span></span><br><span class="line">        cont &amp;= <span class="number">0x07</span>;    </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="1-5-流水灯实验结果"><a href="#1-5-流水灯实验结果" class="headerlink" title="1.5 流水灯实验结果"></a>1.5 流水灯实验结果</h2><p>流水灯实验结果如图11所示，实验现象表示为LED1~LED8依次被点亮。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-164387141714525.png" alt=" "></p>
<center> 图 11 流水灯实验结果</center>



<h1 id="2-实验二-双端口存储器实验"><a href="#2-实验二-双端口存储器实验" class="headerlink" title="2 实验二 双端口存储器实验"></a>2 实验二 双端口存储器实验</h1><h2 id="2-1-实验目的"><a href="#2-1-实验目的" class="headerlink" title="2.1 实验目的"></a>2.1 实验目的</h2><p>（1）熟练掌握GPIO输入输出操作。</p>
<p>（2）掌握存储器原理及应用。</p>
<p>（3）学会根据时序图编写程序。</p>
<h2 id="2-2-实验原理及内容"><a href="#2-2-实验原理及内容" class="headerlink" title="2.2 实验原理及内容"></a>2.2 实验原理及内容</h2><p><strong>（1）双端口存储器简介</strong></p>
<p>双端口存储器是指同一个存储器具有两组相互独立的读写控制线路,进行并行的独立操作，是一种高速工作的存储器。</p>
<ol>
<li><strong>双端口存储器</strong></li>
</ol>
<p>双端口存储器的结构图如图12所示。其中：</p>
<p>clock:系统时钟50Mhz，用于提供RAM读写数据；</p>
<p>wraddress:写数据地址，将数据写入该地址的RAM存储区内；</p>
<p>data:写入的数据0~7；</p>
<p>wren:写使能高电平有效；</p>
<p>rdadress:读数据地址，将内存中的数据从RAM存储区读出；</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/2021070723490282.png" alt=" "></p>
<center>图 12 双端口存储器结构图</center>



<p>此外，数据写入写出时的波形分别如图13和图14所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707234926504.png" alt=" "></p>
<center>图 13 数据写入时波形</center>

<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/2021070723495429.png" alt=" "></p>
<center>图 14 数据读取时波形</center>

<h2 id="2-3-完整的硬件接线图和程序流程图"><a href="#2-3-完整的硬件接线图和程序流程图" class="headerlink" title="2.3 完整的硬件接线图和程序流程图"></a>2.3 完整的硬件接线图和程序流程图</h2><p><strong>（1）硬件接线图</strong></p>
<p>完整的硬件接线图如图15所示。其中P2接口与P10接口相连，P1接口与P11接口相连，P12接口与P13接口相连。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-164387140352420.png" alt=" "></p>
<center>图 15 存储器硬件接线图</center>



<p><strong>（2）软件程序流程图</strong></p>
<p>Quartus中的程序流程图如图16所示，Keil中的软件流程图如图17所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-164387140046918.png" alt=" "></p>
<center>图 16 Quartus中的程序流程图</center>

<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-164387139831916.png" alt=" "></p>
<center>图 17 Keil中的软件流程图</center>

<h2 id="2-4-存储器源代码程序"><a href="#2-4-存储器源代码程序" class="headerlink" title="2.4 存储器源代码程序"></a>2.4 存储器源代码程序</h2><p><strong>（1）double_ram.v</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="function"><span class="keyword">module</span> <span class="title">double_ram</span><span class="params">(  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">2.</span>	       clock,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">3.</span>	         data,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">4.</span>	         rdaddress,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">5.</span>	         wraddress,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">6.</span>	         wren,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">7.</span>	         q  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">8.</span>	         )</span></span>;  <span class="comment">// 定义参数  </span></span><br><span class="line"><span class="number">9.</span>	        input clock;  </span><br><span class="line"><span class="number">10.</span>	    input [<span class="number">3</span>:<span class="number">0</span>]data;  </span><br><span class="line"><span class="number">11.</span>	    input [<span class="number">2</span>:<span class="number">0</span>]rdaddress;  </span><br><span class="line"><span class="number">12.</span>	    input [<span class="number">2</span>:<span class="number">0</span>]wraddress;  </span><br><span class="line"><span class="number">13.</span>	    input wren;  </span><br><span class="line"><span class="number">14.</span>	    output [<span class="number">3</span>:<span class="number">0</span>]q;  </span><br><span class="line"><span class="number">15.</span>	      </span><br><span class="line"><span class="number">16.</span>	    wire [<span class="number">3</span>:<span class="number">0</span>]n_rdaddress = &#123;<span class="number">1&#x27;b</span>0,rdaddress&#125;;  </span><br><span class="line"><span class="number">17.</span>	    wire [<span class="number">3</span>:<span class="number">0</span>]n_wraddress = &#123;<span class="number">1&#x27;b</span>0,wraddress&#125;;  </span><br><span class="line"><span class="number">18.</span>	      </span><br><span class="line"><span class="number">19.</span>	<span class="comment">// 调用模块  </span></span><br><span class="line"><span class="number">20.</span>	ram2 ram2  </span><br><span class="line"><span class="number">21.</span>	(  </span><br><span class="line"><span class="number">22.</span>	    .clock(clock),  </span><br><span class="line"><span class="number">23.</span>	    .data(data),  </span><br><span class="line"><span class="number">24.</span>	    .rdaddress(n_rdaddress),  </span><br><span class="line"><span class="number">25.</span>	    .wraddress(n_wraddress),  </span><br><span class="line"><span class="number">26.</span>	    .wren(wren),  </span><br><span class="line"><span class="number">27.</span>	    .q(q)  </span><br><span class="line"><span class="number">28.</span>	);  </span><br><span class="line"><span class="number">29.</span>	endmodule</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>（2）ram.2v</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="comment">// megafunction wizard: %RAM: 2-PORT%  </span></span><br><span class="line"><span class="number">2.</span>	<span class="comment">// GENERATION: STANDARD  </span></span><br><span class="line"><span class="number">3.</span>	<span class="comment">// VERSION: WM1.0  </span></span><br><span class="line"><span class="number">4.</span>	<span class="comment">// MODULE: altsyncram   </span></span><br><span class="line"><span class="number">5.</span>	  </span><br><span class="line"><span class="number">6.</span>	<span class="comment">// ============================================================  </span></span><br><span class="line"><span class="number">7.</span>	<span class="comment">// File Name: ram2.v  </span></span><br><span class="line"><span class="number">8.</span>	<span class="comment">// Megafunction Name(s):  </span></span><br><span class="line"><span class="number">9.</span>	<span class="comment">//          altsyncram  </span></span><br><span class="line"><span class="number">10.</span>	<span class="comment">//  </span></span><br><span class="line"><span class="number">11.</span>	<span class="comment">// Simulation Library Files(s):  </span></span><br><span class="line"><span class="number">12.</span>	<span class="comment">//          altera_mf  </span></span><br><span class="line"><span class="number">13.</span>	<span class="comment">// ============================================================  </span></span><br><span class="line"><span class="number">14.</span>	<span class="comment">// ************************************************************  </span></span><br><span class="line"><span class="number">15.</span>	<span class="comment">// THIS IS A WIZARD-GENERATED FILE. DO NOT EDIT THIS FILE!  </span></span><br><span class="line"><span class="number">16.</span>	<span class="comment">//  </span></span><br><span class="line"><span class="number">17.</span>	<span class="comment">// 13.1.0 Build 162 10/23/2013 SJ Full Version  </span></span><br><span class="line"><span class="number">18.</span>	<span class="comment">// ************************************************************  </span></span><br><span class="line"><span class="number">19.</span>	  </span><br><span class="line"><span class="number">20.</span>	  </span><br><span class="line"><span class="number">21.</span>	<span class="comment">//Copyright (C) 1991-2013 Altera Corporation  </span></span><br><span class="line"><span class="number">22.</span>	<span class="comment">//Your use of Altera Corporation&#x27;s design tools, logic functions   </span></span><br><span class="line"><span class="number">23.</span>	<span class="comment">//and other software and tools, and its AMPP partner logic   </span></span><br><span class="line"><span class="number">24.</span>	<span class="comment">//functions, and any output files from any of the foregoing   </span></span><br><span class="line"><span class="number">25.</span>	<span class="comment">//(including device programming or simulation files), and any   </span></span><br><span class="line"><span class="number">26.</span>	<span class="comment">//associated documentation or information are expressly subject   </span></span><br><span class="line"><span class="number">27.</span>	<span class="comment">//to the terms and conditions of the Altera Program License   </span></span><br><span class="line"><span class="number">28.</span>	<span class="comment">//Subscription Agreement, Altera MegaCore Function License   </span></span><br><span class="line"><span class="number">29.</span>	<span class="comment">//Agreement, or other applicable license agreement, including,   </span></span><br><span class="line"><span class="number">30.</span>	<span class="comment">//without limitation, that your use is for the sole purpose of   </span></span><br><span class="line"><span class="number">31.</span>	<span class="comment">//programming logic devices manufactured by Altera and sold by   </span></span><br><span class="line"><span class="number">32.</span>	<span class="comment">//Altera or its authorized distributors.  Please refer to the   </span></span><br><span class="line"><span class="number">33.</span>	<span class="comment">//applicable agreement for further details.  </span></span><br><span class="line"><span class="number">34.</span>	  </span><br><span class="line"><span class="number">35.</span>	  </span><br><span class="line"><span class="number">36.</span>	<span class="comment">// synopsys translate_off  </span></span><br><span class="line"><span class="number">37.</span>	`timescale <span class="number">1</span> ps / <span class="number">1</span> ps  </span><br><span class="line"><span class="number">38.</span>	<span class="comment">// synopsys translate_on  </span></span><br><span class="line"><span class="number">39.</span>	<span class="function"><span class="keyword">module</span> <span class="title">ram2</span> <span class="params">(  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">40.</span>	    clock,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">41.</span>	    data,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">42.</span>	    rdaddress,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">43.</span>	    wraddress,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">44.</span>	    wren,  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">45.</span>	    q)</span></span>;  </span><br><span class="line"><span class="number">46.</span>	  </span><br><span class="line"><span class="number">47.</span>	    input     clock;  </span><br><span class="line"><span class="number">48.</span>	    input   [<span class="number">3</span>:<span class="number">0</span>]  data;  </span><br><span class="line"><span class="number">49.</span>	    input   [<span class="number">3</span>:<span class="number">0</span>]  rdaddress;  </span><br><span class="line"><span class="number">50.</span>	    input   [<span class="number">3</span>:<span class="number">0</span>]  wraddress;  </span><br><span class="line"><span class="number">51.</span>	    input     wren;  </span><br><span class="line"><span class="number">52.</span>	    output  [<span class="number">3</span>:<span class="number">0</span>]  q;  </span><br><span class="line"><span class="number">53.</span>	`ifndef ALTERA_RESERVED_QIS  </span><br><span class="line"><span class="number">54.</span>	<span class="comment">// synopsys translate_off  </span></span><br><span class="line"><span class="number">55.</span>	`endif  </span><br><span class="line"><span class="number">56.</span>	    tri1      clock;  </span><br><span class="line"><span class="number">57.</span>	    tri0      wren;  </span><br><span class="line"><span class="number">58.</span>	`ifndef ALTERA_RESERVED_QIS  </span><br><span class="line"><span class="number">59.</span>	<span class="comment">// synopsys translate_on  </span></span><br><span class="line"><span class="number">60.</span>	`endif  </span><br><span class="line"><span class="number">61.</span>	  </span><br><span class="line"><span class="number">62.</span>	    wire [<span class="number">3</span>:<span class="number">0</span>] sub_wire0;  </span><br><span class="line"><span class="number">63.</span>	    wire [<span class="number">3</span>:<span class="number">0</span>] q = sub_wire0[<span class="number">3</span>:<span class="number">0</span>];  </span><br><span class="line"><span class="number">64.</span>	  </span><br><span class="line"><span class="number">65.</span>	    <span class="function">altsyncram  <span class="title">altsyncram_component</span> <span class="params">(  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">66.</span>	                .address_a (wraddress),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">67.</span>	                .clock0 (clock),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">68.</span>	                .data_a (data),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">69.</span>	                .wren_a (wren),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">70.</span>	                .address_b (rdaddress),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">71.</span>	                .q_b (sub_wire0),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">72.</span>	                .aclr0 (<span class="number">1&#x27;b</span>0),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">73.</span>	                .aclr1 (<span class="number">1&#x27;b</span>0),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">74.</span>	                .addressstall_a (<span class="number">1&#x27;b</span>0),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">75.</span>	                .addressstall_b (<span class="number">1&#x27;b</span>0),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">76.</span>	                .byteena_a (<span class="number">1&#x27;b</span>1),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">77.</span>	                .byteena_b (<span class="number">1&#x27;b</span>1),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">78.</span>	                .clock1 (<span class="number">1&#x27;b</span>1),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">79.</span>	                .clocken0 (<span class="number">1&#x27;b</span>1),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">80.</span>	                .clocken1 (<span class="number">1&#x27;b</span>1),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">81.</span>	                .clocken2 (<span class="number">1&#x27;b</span>1),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">82.</span>	                .clocken3 (<span class="number">1&#x27;b</span>1),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">83.</span>	                .data_b (&#123;<span class="number">4</span>&#123;<span class="number">1&#x27;b</span>1&#125;&#125;),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">84.</span>	                .eccstatus (),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">85.</span>	                .q_a (),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">86.</span>	                .rden_a (<span class="number">1&#x27;b</span>1),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">87.</span>	                .rden_b (<span class="number">1&#x27;b</span>1),  </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">88.</span>	                .wren_b (<span class="number">1&#x27;b</span>0))</span></span>;  </span><br><span class="line"><span class="number">89.</span>	    defparam  </span><br><span class="line"><span class="number">90.</span>	        altsyncram_component.address_aclr_b = <span class="string">&quot;NONE&quot;</span>,  </span><br><span class="line"><span class="number">91.</span>	        altsyncram_component.address_reg_b = <span class="string">&quot;CLOCK0&quot;</span>,  </span><br><span class="line"><span class="number">92.</span>	        altsyncram_component.clock_enable_input_a = <span class="string">&quot;BYPASS&quot;</span>,  </span><br><span class="line"><span class="number">93.</span>	        altsyncram_component.clock_enable_input_b = <span class="string">&quot;BYPASS&quot;</span>,  </span><br><span class="line"><span class="number">94.</span>	        altsyncram_component.clock_enable_output_b = <span class="string">&quot;BYPASS&quot;</span>,  </span><br><span class="line"><span class="number">95.</span>	        altsyncram_component.intended_device_family = <span class="string">&quot;Cyclone IV E&quot;</span>,  </span><br><span class="line"><span class="number">96.</span>	        altsyncram_component.lpm_type = <span class="string">&quot;altsyncram&quot;</span>,  </span><br><span class="line"><span class="number">97.</span>	        altsyncram_component.numwords_a = <span class="number">16</span>,  </span><br><span class="line"><span class="number">98.</span>	        altsyncram_component.numwords_b = <span class="number">16</span>,  </span><br><span class="line"><span class="number">99.</span>	        altsyncram_component.operation_mode = <span class="string">&quot;DUAL_PORT&quot;</span>,  </span><br><span class="line"><span class="number">100.</span>	        altsyncram_component.outdata_aclr_b = <span class="string">&quot;NONE&quot;</span>,  </span><br><span class="line"><span class="number">101.</span>	        altsyncram_component.outdata_reg_b = <span class="string">&quot;CLOCK0&quot;</span>,  </span><br><span class="line"><span class="number">102.</span>	        altsyncram_component.power_up_uninitialized = <span class="string">&quot;FALSE&quot;</span>,  </span><br><span class="line"><span class="number">103.</span>	        altsyncram_component.read_during_write_mode_mixed_ports = <span class="string">&quot;DONT_CARE&quot;</span>,  </span><br><span class="line"><span class="number">104.</span>	        altsyncram_component.widthad_a = <span class="number">4</span>,  </span><br><span class="line"><span class="number">105.</span>	        altsyncram_component.widthad_b = <span class="number">4</span>,  </span><br><span class="line"><span class="number">106.</span>	        altsyncram_component.width_a = <span class="number">4</span>,  </span><br><span class="line"><span class="number">107.</span>	        altsyncram_component.width_b = <span class="number">4</span>,  </span><br><span class="line"><span class="number">108.</span>	        altsyncram_component.width_byteena_a = <span class="number">1</span>;  </span><br><span class="line"><span class="number">109.</span>	  </span><br><span class="line"><span class="number">110.</span>	  </span><br><span class="line"><span class="number">111.</span>	endmodule  </span><br><span class="line"><span class="number">112.</span>	  </span><br><span class="line"><span class="number">113.</span>	<span class="comment">// ============================================================  </span></span><br><span class="line"><span class="number">114.</span>	<span class="comment">// CNX file retrieval info  </span></span><br><span class="line"><span class="number">115.</span>	<span class="comment">// ============================================================  </span></span><br><span class="line"><span class="number">116.</span>	<span class="comment">// Retrieval info: PRIVATE: ADDRESSSTALL_A NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">117.</span>	<span class="comment">// Retrieval info: PRIVATE: ADDRESSSTALL_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">118.</span>	<span class="comment">// Retrieval info: PRIVATE: BYTEENA_ACLR_A NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">119.</span>	<span class="comment">// Retrieval info: PRIVATE: BYTEENA_ACLR_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">120.</span>	<span class="comment">// Retrieval info: PRIVATE: BYTE_ENABLE_A NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">121.</span>	<span class="comment">// Retrieval info: PRIVATE: BYTE_ENABLE_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">122.</span>	<span class="comment">// Retrieval info: PRIVATE: BYTE_SIZE NUMERIC &quot;8&quot;  </span></span><br><span class="line"><span class="number">123.</span>	<span class="comment">// Retrieval info: PRIVATE: BlankMemory NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">124.</span>	<span class="comment">// Retrieval info: PRIVATE: CLOCK_ENABLE_INPUT_A NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">125.</span>	<span class="comment">// Retrieval info: PRIVATE: CLOCK_ENABLE_INPUT_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">126.</span>	<span class="comment">// Retrieval info: PRIVATE: CLOCK_ENABLE_OUTPUT_A NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">127.</span>	<span class="comment">// Retrieval info: PRIVATE: CLOCK_ENABLE_OUTPUT_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">128.</span>	<span class="comment">// Retrieval info: PRIVATE: CLRdata NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">129.</span>	<span class="comment">// Retrieval info: PRIVATE: CLRq NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">130.</span>	<span class="comment">// Retrieval info: PRIVATE: CLRrdaddress NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">131.</span>	<span class="comment">// Retrieval info: PRIVATE: CLRrren NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">132.</span>	<span class="comment">// Retrieval info: PRIVATE: CLRwraddress NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">133.</span>	<span class="comment">// Retrieval info: PRIVATE: CLRwren NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">134.</span>	<span class="comment">// Retrieval info: PRIVATE: Clock NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">135.</span>	<span class="comment">// Retrieval info: PRIVATE: Clock_A NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">136.</span>	<span class="comment">// Retrieval info: PRIVATE: Clock_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">137.</span>	<span class="comment">// Retrieval info: PRIVATE: IMPLEMENT_IN_LES NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">138.</span>	<span class="comment">// Retrieval info: PRIVATE: INDATA_ACLR_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">139.</span>	<span class="comment">// Retrieval info: PRIVATE: INDATA_REG_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">140.</span>	<span class="comment">// Retrieval info: PRIVATE: INIT_FILE_LAYOUT STRING &quot;PORT_B&quot;  </span></span><br><span class="line"><span class="number">141.</span>	<span class="comment">// Retrieval info: PRIVATE: INIT_TO_SIM_X NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">142.</span>	<span class="comment">// Retrieval info: PRIVATE: INTENDED_DEVICE_FAMILY STRING &quot;Cyclone IV E&quot;  </span></span><br><span class="line"><span class="number">143.</span>	<span class="comment">// Retrieval info: PRIVATE: JTAG_ENABLED NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">144.</span>	<span class="comment">// Retrieval info: PRIVATE: JTAG_ID STRING &quot;NONE&quot;  </span></span><br><span class="line"><span class="number">145.</span>	<span class="comment">// Retrieval info: PRIVATE: MAXIMUM_DEPTH NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">146.</span>	<span class="comment">// Retrieval info: PRIVATE: MEMSIZE NUMERIC &quot;64&quot;  </span></span><br><span class="line"><span class="number">147.</span>	<span class="comment">// Retrieval info: PRIVATE: MEM_IN_BITS NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">148.</span>	<span class="comment">// Retrieval info: PRIVATE: MIFfilename STRING &quot;&quot;  </span></span><br><span class="line"><span class="number">149.</span>	<span class="comment">// Retrieval info: PRIVATE: OPERATION_MODE NUMERIC &quot;2&quot;  </span></span><br><span class="line"><span class="number">150.</span>	<span class="comment">// Retrieval info: PRIVATE: OUTDATA_ACLR_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">151.</span>	<span class="comment">// Retrieval info: PRIVATE: OUTDATA_REG_B NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">152.</span>	<span class="comment">// Retrieval info: PRIVATE: RAM_BLOCK_TYPE NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">153.</span>	<span class="comment">// Retrieval info: PRIVATE: READ_DURING_WRITE_MODE_MIXED_PORTS NUMERIC &quot;2&quot;  </span></span><br><span class="line"><span class="number">154.</span>	<span class="comment">// Retrieval info: PRIVATE: READ_DURING_WRITE_MODE_PORT_A NUMERIC &quot;3&quot;  </span></span><br><span class="line"><span class="number">155.</span>	<span class="comment">// Retrieval info: PRIVATE: READ_DURING_WRITE_MODE_PORT_B NUMERIC &quot;3&quot;  </span></span><br><span class="line"><span class="number">156.</span>	<span class="comment">// Retrieval info: PRIVATE: REGdata NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">157.</span>	<span class="comment">// Retrieval info: PRIVATE: REGq NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">158.</span>	<span class="comment">// Retrieval info: PRIVATE: REGrdaddress NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">159.</span>	<span class="comment">// Retrieval info: PRIVATE: REGrren NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">160.</span>	<span class="comment">// Retrieval info: PRIVATE: REGwraddress NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">161.</span>	<span class="comment">// Retrieval info: PRIVATE: REGwren NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">162.</span>	<span class="comment">// Retrieval info: PRIVATE: SYNTH_WRAPPER_GEN_POSTFIX STRING &quot;0&quot;  </span></span><br><span class="line"><span class="number">163.</span>	<span class="comment">// Retrieval info: PRIVATE: USE_DIFF_CLKEN NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">164.</span>	<span class="comment">// Retrieval info: PRIVATE: UseDPRAM NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">165.</span>	<span class="comment">// Retrieval info: PRIVATE: VarWidth NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">166.</span>	<span class="comment">// Retrieval info: PRIVATE: WIDTH_READ_A NUMERIC &quot;4&quot;  </span></span><br><span class="line"><span class="number">167.</span>	<span class="comment">// Retrieval info: PRIVATE: WIDTH_READ_B NUMERIC &quot;4&quot;  </span></span><br><span class="line"><span class="number">168.</span>	<span class="comment">// Retrieval info: PRIVATE: WIDTH_WRITE_A NUMERIC &quot;4&quot;  </span></span><br><span class="line"><span class="number">169.</span>	<span class="comment">// Retrieval info: PRIVATE: WIDTH_WRITE_B NUMERIC &quot;4&quot;  </span></span><br><span class="line"><span class="number">170.</span>	<span class="comment">// Retrieval info: PRIVATE: WRADDR_ACLR_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">171.</span>	<span class="comment">// Retrieval info: PRIVATE: WRADDR_REG_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">172.</span>	<span class="comment">// Retrieval info: PRIVATE: WRCTRL_ACLR_B NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">173.</span>	<span class="comment">// Retrieval info: PRIVATE: enable NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">174.</span>	<span class="comment">// Retrieval info: PRIVATE: rden NUMERIC &quot;0&quot;  </span></span><br><span class="line"><span class="number">175.</span>	<span class="comment">// Retrieval info: LIBRARY: altera_mf altera_mf.altera_mf_components.all  </span></span><br><span class="line"><span class="number">176.</span>	<span class="comment">// Retrieval info: CONSTANT: ADDRESS_ACLR_B STRING &quot;NONE&quot;  </span></span><br><span class="line"><span class="number">177.</span>	<span class="comment">// Retrieval info: CONSTANT: ADDRESS_REG_B STRING &quot;CLOCK0&quot;  </span></span><br><span class="line"><span class="number">178.</span>	<span class="comment">// Retrieval info: CONSTANT: CLOCK_ENABLE_INPUT_A STRING &quot;BYPASS&quot;  </span></span><br><span class="line"><span class="number">179.</span>	<span class="comment">// Retrieval info: CONSTANT: CLOCK_ENABLE_INPUT_B STRING &quot;BYPASS&quot;  </span></span><br><span class="line"><span class="number">180.</span>	<span class="comment">// Retrieval info: CONSTANT: CLOCK_ENABLE_OUTPUT_B STRING &quot;BYPASS&quot;  </span></span><br><span class="line"><span class="number">181.</span>	<span class="comment">// Retrieval info: CONSTANT: INTENDED_DEVICE_FAMILY STRING &quot;Cyclone IV E&quot;  </span></span><br><span class="line"><span class="number">182.</span>	<span class="comment">// Retrieval info: CONSTANT: LPM_TYPE STRING &quot;altsyncram&quot;  </span></span><br><span class="line"><span class="number">183.</span>	<span class="comment">// Retrieval info: CONSTANT: NUMWORDS_A NUMERIC &quot;16&quot;  </span></span><br><span class="line"><span class="number">184.</span>	<span class="comment">// Retrieval info: CONSTANT: NUMWORDS_B NUMERIC &quot;16&quot;  </span></span><br><span class="line"><span class="number">185.</span>	<span class="comment">// Retrieval info: CONSTANT: OPERATION_MODE STRING &quot;DUAL_PORT&quot;  </span></span><br><span class="line"><span class="number">186.</span>	<span class="comment">// Retrieval info: CONSTANT: OUTDATA_ACLR_B STRING &quot;NONE&quot;  </span></span><br><span class="line"><span class="number">187.</span>	<span class="comment">// Retrieval info: CONSTANT: OUTDATA_REG_B STRING &quot;CLOCK0&quot;  </span></span><br><span class="line"><span class="number">188.</span>	<span class="comment">// Retrieval info: CONSTANT: POWER_UP_UNINITIALIZED STRING &quot;FALSE&quot;  </span></span><br><span class="line"><span class="number">189.</span>	<span class="comment">// Retrieval info: CONSTANT: READ_DURING_WRITE_MODE_MIXED_PORTS STRING &quot;DONT_CARE&quot;  </span></span><br><span class="line"><span class="number">190.</span>	<span class="comment">// Retrieval info: CONSTANT: WIDTHAD_A NUMERIC &quot;4&quot;  </span></span><br><span class="line"><span class="number">191.</span>	<span class="comment">// Retrieval info: CONSTANT: WIDTHAD_B NUMERIC &quot;4&quot;  </span></span><br><span class="line"><span class="number">192.</span>	<span class="comment">// Retrieval info: CONSTANT: WIDTH_A NUMERIC &quot;4&quot;  </span></span><br><span class="line"><span class="number">193.</span>	<span class="comment">// Retrieval info: CONSTANT: WIDTH_B NUMERIC &quot;4&quot;  </span></span><br><span class="line"><span class="number">194.</span>	<span class="comment">// Retrieval info: CONSTANT: WIDTH_BYTEENA_A NUMERIC &quot;1&quot;  </span></span><br><span class="line"><span class="number">195.</span>	<span class="comment">// Retrieval info: USED_PORT: clock 0 0 0 0 INPUT VCC &quot;clock&quot;  </span></span><br><span class="line"><span class="number">196.</span>	<span class="comment">// Retrieval info: USED_PORT: data 0 0 4 0 INPUT NODEFVAL &quot;data[3..0]&quot;  </span></span><br><span class="line"><span class="number">197.</span>	<span class="comment">// Retrieval info: USED_PORT: q 0 0 4 0 OUTPUT NODEFVAL &quot;q[3..0]&quot;  </span></span><br><span class="line"><span class="number">198.</span>	<span class="comment">// Retrieval info: USED_PORT: rdaddress 0 0 4 0 INPUT NODEFVAL &quot;rdaddress[3..0]&quot;  </span></span><br><span class="line"><span class="number">199.</span>	<span class="comment">// Retrieval info: USED_PORT: wraddress 0 0 4 0 INPUT NODEFVAL &quot;wraddress[3..0]&quot;  </span></span><br><span class="line"><span class="number">200.</span>	<span class="comment">// Retrieval info: USED_PORT: wren 0 0 0 0 INPUT GND &quot;wren&quot;  </span></span><br><span class="line"><span class="number">201.</span>	<span class="comment">// Retrieval info: CONNECT: @address_a 0 0 4 0 wraddress 0 0 4 0  </span></span><br><span class="line"><span class="number">202.</span>	<span class="comment">// Retrieval info: CONNECT: @address_b 0 0 4 0 rdaddress 0 0 4 0  </span></span><br><span class="line"><span class="number">203.</span>	<span class="comment">// Retrieval info: CONNECT: @clock0 0 0 0 0 clock 0 0 0 0  </span></span><br><span class="line"><span class="number">204.</span>	<span class="comment">// Retrieval info: CONNECT: @data_a 0 0 4 0 data 0 0 4 0  </span></span><br><span class="line"><span class="number">205.</span>	<span class="comment">// Retrieval info: CONNECT: @wren_a 0 0 0 0 wren 0 0 0 0  </span></span><br><span class="line"><span class="number">206.</span>	<span class="comment">// Retrieval info: CONNECT: q 0 0 4 0 @q_b 0 0 4 0  </span></span><br><span class="line"><span class="number">207.</span>	<span class="comment">// Retrieval info: GEN_FILE: TYPE_NORMAL ram2.v TRUE  </span></span><br><span class="line"><span class="number">208.</span>	<span class="comment">// Retrieval info: GEN_FILE: TYPE_NORMAL ram2.inc FALSE  </span></span><br><span class="line"><span class="number">209.</span>	<span class="comment">// Retrieval info: GEN_FILE: TYPE_NORMAL ram2.cmp FALSE  </span></span><br><span class="line"><span class="number">210.</span>	<span class="comment">// Retrieval info: GEN_FILE: TYPE_NORMAL ram2.bsf FALSE  </span></span><br><span class="line"><span class="number">211.</span>	<span class="comment">// Retrieval info: GEN_FILE: TYPE_NORMAL ram2_inst.v FALSE  </span></span><br><span class="line"><span class="number">212.</span>	<span class="comment">// Retrieval info: GEN_FILE: TYPE_NORMAL ram2_bb.v TRUE  </span></span><br><span class="line"><span class="number">213.</span>	<span class="comment">// Retrieval info: LIB_FILE: altera_mf  </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> <strong>（3）main.c</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="comment">/******************************************************************* </span></span><br><span class="line"><span class="comment">2.	实验名称：第2次试验.拨档开关输入实验 </span></span><br><span class="line"><span class="comment">3.	 </span></span><br><span class="line"><span class="comment">4.	硬件模块：计算机原理应用实验箱 </span></span><br><span class="line"><span class="comment">5.	 </span></span><br><span class="line"><span class="comment">6.	硬件接线：P12-P13,P11-P1,P10-P2 </span></span><br><span class="line"><span class="comment">7.	实验现象：拨码开关状态映射到LED灯上。 </span></span><br><span class="line"><span class="comment">8.	             </span></span><br><span class="line"><span class="comment">9.	key 1 读 Key 2 写 </span></span><br><span class="line"><span class="comment">10.	********************************************************************/</span>  </span><br><span class="line"><span class="number">11.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f4xx.h&quot;</span>  </span></span><br><span class="line"><span class="number">12.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span>  </span></span><br><span class="line"><span class="number">13.</span>	  </span><br><span class="line"><span class="number">14.</span>	<span class="comment">/******************************* </span></span><br><span class="line"><span class="comment">15.	功  能：LED端口初始化 </span></span><br><span class="line"><span class="comment">16.	参  数：无 </span></span><br><span class="line"><span class="comment">17.	返回值：无 </span></span><br><span class="line"><span class="comment">18.	*******************************/</span>  </span><br><span class="line"><span class="number">19.</span>	  </span><br><span class="line"><span class="number">20.</span>	  </span><br><span class="line"><span class="number">21.</span>	<span class="meta">#<span class="meta-keyword">define</span> KEY_READ()       GPIO_ReadInputDataBit(GPIOC, GPIO_Pin_8)              <span class="comment">// 上按键检测  </span></span></span><br><span class="line"><span class="number">22.</span>	<span class="meta">#<span class="meta-keyword">define</span> KEY_WRITE()       GPIO_ReadInputDataBit(GPIOC, GPIO_Pin_11)            <span class="comment">// 下按键检测  </span></span></span><br><span class="line"><span class="number">23.</span>	  </span><br><span class="line"><span class="number">24.</span>	  </span><br><span class="line"><span class="number">25.</span>	<span class="meta">#<span class="meta-keyword">define</span> CLK(val)     GPIO_WriteBit(GPIOF, GPIO_Pin_6, (BitAction)val)          <span class="comment">// FPGA 时钟信号  </span></span></span><br><span class="line"><span class="number">26.</span>	<span class="meta">#<span class="meta-keyword">define</span> WREN(val)    GPIO_WriteBit(GPIOF, GPIO_Pin_7, (BitAction)val)          <span class="comment">// FPGA 读写信号  </span></span></span><br><span class="line"><span class="number">27.</span>	  </span><br><span class="line"><span class="number">28.</span>	  </span><br><span class="line"><span class="number">29.</span>	<span class="comment">/******************************* </span></span><br><span class="line"><span class="comment">30.	功  能：LED灯读写数据显示 </span></span><br><span class="line"><span class="comment">31.	参  数：无 </span></span><br><span class="line"><span class="comment">32.	返回值：无 </span></span><br><span class="line"><span class="comment">33.	*******************************/</span>  </span><br><span class="line"><span class="number">34.</span>	  </span><br><span class="line"><span class="number">35.</span>	<span class="function"><span class="keyword">void</span> <span class="title">Led_Init</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">36.	</span>&#123;  </span><br><span class="line"><span class="number">37.</span>	    GPIO_InitTypeDef   GPIO_InitStructure;  </span><br><span class="line"><span class="number">38.</span>	  </span><br><span class="line"><span class="number">39.</span>	    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOB, ENABLE);   <span class="comment">//开启GPIOB的时钟  </span></span><br><span class="line"><span class="number">40.</span>	      </span><br><span class="line"><span class="number">41.</span>	    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3 \  </span><br><span class="line"><span class="number">42.</span>	                                | GPIO_Pin_4 | GPIO_Pin_5 | GPIO_Pin_6 | GPIO_Pin_7;  </span><br><span class="line"><span class="number">43.</span>	      </span><br><span class="line"><span class="number">44.</span>	    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;          <span class="comment">//输出模式  </span></span><br><span class="line"><span class="number">45.</span>	    GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;         <span class="comment">//推挽输出   </span></span><br><span class="line"><span class="number">46.</span>	    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;      <span class="comment">//速度50MHz  </span></span><br><span class="line"><span class="number">47.</span>	    GPIO_Init(GPIOB, &amp;GPIO_InitStructure);  </span><br><span class="line"><span class="number">48.</span>	    GPIO_Write(GPIOB, <span class="number">0x0000</span>);        </span><br><span class="line"><span class="number">49.</span>	&#125;  </span><br><span class="line"><span class="number">50.</span>	  </span><br><span class="line"><span class="number">51.</span>	<span class="comment">/******************************* </span></span><br><span class="line"><span class="comment">52.	功  能：拨码开关端口初始化 </span></span><br><span class="line"><span class="comment">53.	参  数：无 </span></span><br><span class="line"><span class="comment">54.	返回值：无 </span></span><br><span class="line"><span class="comment">55.	*******************************/</span>  </span><br><span class="line"><span class="number">56.</span>	<span class="function"><span class="keyword">void</span> <span class="title">Sw_Init</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">57.	</span>&#123;  </span><br><span class="line"><span class="number">58.</span>	    GPIO_InitTypeDef   GPIO_InitStructure;  </span><br><span class="line"><span class="number">59.</span>	  </span><br><span class="line"><span class="number">60.</span>	    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOC, ENABLE);   <span class="comment">//开启GPIOC的时钟  </span></span><br><span class="line"><span class="number">61.</span>	  </span><br><span class="line"><span class="number">62.</span>	    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2 | GPIO_Pin_3   </span><br><span class="line"><span class="number">63.</span>	                                | GPIO_Pin_4 | GPIO_Pin_5 | GPIO_Pin_6 | GPIO_Pin_7  | GPIO_Pin_8 | GPIO_Pin_11;  </span><br><span class="line"><span class="number">64.</span>	  </span><br><span class="line"><span class="number">65.</span>	    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;           <span class="comment">//输入模式  </span></span><br><span class="line"><span class="number">66.</span>	    GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;           <span class="comment">//上拉   </span></span><br><span class="line"><span class="number">67.</span>	    GPIO_Init(GPIOC, &amp;GPIO_InitStructure);  </span><br><span class="line"><span class="number">68.</span>	&#125;  </span><br><span class="line"><span class="number">69.</span>	  </span><br><span class="line"><span class="number">70.</span>	<span class="comment">/******************************* </span></span><br><span class="line"><span class="comment">71.	功  能：GPIOF与FPGA连接初始化 </span></span><br><span class="line"><span class="comment">72.	参  数：无 </span></span><br><span class="line"><span class="comment">73.	返回值：无 </span></span><br><span class="line"><span class="comment">74.	*******************************/</span>  </span><br><span class="line"><span class="number">75.</span>	<span class="function"><span class="keyword">void</span> <span class="title">GPIO_FPGA_Init</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">76.	</span>&#123;  </span><br><span class="line"><span class="number">77.</span>	  GPIO_InitTypeDef   GPIO_InitStructure;  </span><br><span class="line"><span class="number">78.</span>	          </span><br><span class="line"><span class="number">79.</span>	    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOF, ENABLE);   <span class="comment">//开启GPIOF的时钟  </span></span><br><span class="line"><span class="number">80.</span>	      </span><br><span class="line"><span class="number">81.</span>	    GPIO_InitStructure.GPIO_Pin = <span class="number">0x0fff</span>;  </span><br><span class="line"><span class="number">82.</span>	      </span><br><span class="line"><span class="number">83.</span>	    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;        <span class="comment">//输出模式  </span></span><br><span class="line"><span class="number">84.</span>	    GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;       <span class="comment">//推挽输出   </span></span><br><span class="line"><span class="number">85.</span>	    GPIO_InitStructure.GPIO_Speed = GPIO_High_Speed;     <span class="comment">//输出速率25MHz   </span></span><br><span class="line"><span class="number">86.</span>	    GPIO_Init(GPIOF, &amp;GPIO_InitStructure);  </span><br><span class="line"><span class="number">87.</span>	      </span><br><span class="line"><span class="number">88.</span>	      </span><br><span class="line"><span class="number">89.</span>	  GPIO_InitStructure.GPIO_Pin = <span class="number">0xf000</span>;  </span><br><span class="line"><span class="number">90.</span>	    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;          <span class="comment">//输出模式  </span></span><br><span class="line"><span class="number">91.</span>	  GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;  </span><br><span class="line"><span class="number">92.</span>	    GPIO_Init(GPIOF, &amp;GPIO_InitStructure);  </span><br><span class="line"><span class="number">93.</span>	&#125;  </span><br><span class="line"><span class="number">94.</span>	  </span><br><span class="line"><span class="number">95.</span>	  </span><br><span class="line"><span class="number">96.</span>	  </span><br><span class="line"><span class="number">97.</span>	  </span><br><span class="line"><span class="number">98.</span>	<span class="comment">/************读取数据***************/</span>  </span><br><span class="line"><span class="number">99.</span>	<span class="function"><span class="keyword">void</span> <span class="title">Read_Data</span><span class="params">(<span class="keyword">uint8_t</span> read_addr, <span class="keyword">uint8_t</span> *read_date)</span>  </span></span><br><span class="line"><span class="function">100.	</span>&#123;  </span><br><span class="line"><span class="number">101.</span>	    <span class="keyword">uint16_t</span> buf = <span class="number">0</span>;                                           <span class="comment">// GPIOF 数据变量  </span></span><br><span class="line"><span class="number">102.</span>	    WREN(<span class="number">0</span>);                                                    <span class="comment">// 读数据  </span></span><br><span class="line"><span class="number">103.</span>	  CLK(<span class="number">0</span>);                                                     <span class="comment">// 时钟信号  </span></span><br><span class="line"><span class="number">104.</span>	    buf =  GPIO_ReadOutputData(GPIOF) &amp; <span class="number">0x00C0</span>;                 <span class="comment">// 保留第6、7位,即时钟信号和读写信号不变  </span></span><br><span class="line"><span class="number">105.</span>	    buf |= read_addr;                                           <span class="comment">// 将读取地址放入GPIOF, 读地址 0-2位  </span></span><br><span class="line"><span class="number">106.</span>	    GPIO_Write(GPIOF, buf);                                     <span class="comment">// GPIOF输出数据  </span></span><br><span class="line"><span class="number">107.</span>	    CLK(<span class="number">1</span>);                                                     <span class="comment">// 时钟周期发送读数据地址  </span></span><br><span class="line"><span class="number">108.</span>	  CLK(<span class="number">0</span>);  </span><br><span class="line"><span class="number">109.</span>	    CLK(<span class="number">1</span>);                                                     <span class="comment">// 时钟信号获取内存数据  </span></span><br><span class="line"><span class="number">110.</span>	    *read_date =  ((GPIO_ReadInputData(GPIOF) &amp; <span class="number">0xf000</span>) &gt;&gt; <span class="number">12</span> );<span class="comment">// 获得FPGA返回数据q, 数据pin在12-15位          </span></span><br><span class="line"><span class="number">111.</span>	    WREN(<span class="number">0</span>);  </span><br><span class="line"><span class="number">112.</span>	&#125;  </span><br><span class="line"><span class="number">113.</span>	  </span><br><span class="line"><span class="number">114.</span>	<span class="comment">/***********写入数据***************/</span>  </span><br><span class="line"><span class="number">115.</span>	<span class="function"><span class="keyword">void</span> <span class="title">Write_Data</span><span class="params">(<span class="keyword">uint8_t</span> write_addr, <span class="keyword">uint8_t</span> write_date)</span>  </span></span><br><span class="line"><span class="function">116.	</span>&#123;  </span><br><span class="line"><span class="number">117.</span>	  <span class="keyword">uint16_t</span> buf = <span class="number">0</span>;                                            <span class="comment">// GPIOF 数据变量  </span></span><br><span class="line"><span class="number">118.</span>	    WREN(<span class="number">1</span>);                                                     <span class="comment">// 写数据  </span></span><br><span class="line"><span class="number">119.</span>	  CLK(<span class="number">0</span>);                                                      <span class="comment">// 时钟信号  </span></span><br><span class="line"><span class="number">120.</span>	    buf =  GPIO_ReadOutputData(GPIOF) &amp; <span class="number">0x00C0</span>;                  <span class="comment">// 保留第6、7位,即时钟信号和读写信号不变  </span></span><br><span class="line"><span class="number">121.</span>	    buf |= ((write_addr &amp; <span class="number">0x7</span>) &lt;&lt; <span class="number">3</span>) | (write_date &lt;&lt; <span class="number">8</span>) ;       <span class="comment">// 将读取地址放入GPIOF, 写地址在3-5位，写数据在8-11位  </span></span><br><span class="line"><span class="number">122.</span>	    GPIO_Write(GPIOF, buf);                                      <span class="comment">// GPIOF输出数据  </span></span><br><span class="line"><span class="number">123.</span>	    CLK(<span class="number">1</span>);  </span><br><span class="line"><span class="number">124.</span>	    WREN(<span class="number">0</span>);  </span><br><span class="line"><span class="number">125.</span>	&#125;  </span><br><span class="line"><span class="number">126.</span>	  </span><br><span class="line"><span class="number">127.</span>	<span class="function"><span class="keyword">void</span> <span class="title">Key_Scan</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">128.	</span>&#123;  </span><br><span class="line"><span class="number">129.</span>	       <span class="keyword">uint8_t</span> gpioc_data;  <span class="comment">// GPIOC数据读取变量  </span></span><br><span class="line"><span class="number">130.</span>	       <span class="keyword">uint8_t</span> read_addr;   <span class="comment">// 拨码开关 0-2    </span></span><br><span class="line"><span class="number">131.</span>	       <span class="keyword">uint8_t</span> write_addr;  <span class="comment">// 写入地址  </span></span><br><span class="line"><span class="number">132.</span>	       <span class="keyword">uint8_t</span> read_date;   <span class="comment">// 拨码开关 4-7  </span></span><br><span class="line"><span class="number">133.</span>	         <span class="keyword">uint8_t</span> write_date;  <span class="comment">// 写入数据  </span></span><br><span class="line"><span class="number">134.</span>	       <span class="keyword">if</span>(KEY_READ() == <span class="number">0</span>)  <span class="comment">// 读按键检测  </span></span><br><span class="line"><span class="number">135.</span>	         &#123;  </span><br><span class="line"><span class="number">136.</span>	              Delay_Ms(<span class="number">5</span>);      <span class="comment">// 防抖  </span></span><br><span class="line"><span class="number">137.</span>	              <span class="keyword">if</span>(KEY_READ() == <span class="number">0</span>)  </span><br><span class="line"><span class="number">138.</span>	                &#123;  </span><br><span class="line"><span class="number">139.</span>	                    <span class="keyword">while</span>(KEY_READ() == <span class="number">0</span>)&#123;&#125;;  </span><br><span class="line"><span class="number">140.</span>	                        gpioc_data = ~(GPIO_ReadInputData(GPIOC) &amp; <span class="number">0x00FF</span>);  <span class="comment">// 获取拨码开关数据,上0，下1  </span></span><br><span class="line"><span class="number">141.</span>	                        read_addr = gpioc_data &amp; <span class="number">0x07</span>;                       <span class="comment">// 获得读地址  </span></span><br><span class="line"><span class="number">142.</span>	                        read_date = (gpioc_data &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>;                <span class="comment">// 读数据，这个没用，调试用  </span></span><br><span class="line"><span class="number">143.</span>	                        Read_Data(read_addr, &amp;read_date);                    <span class="comment">// 传入指针读取FPGA内存数据  </span></span><br><span class="line"><span class="number">144.</span>	                        GPIO_Write(GPIOB, read_date);                        <span class="comment">// 获得的数据从GPIOB发送到LED  </span></span><br><span class="line"><span class="number">145.</span>	                            <span class="comment">//LED1(!LED1_DATA());  </span></span><br><span class="line"><span class="number">146.</span>	                &#125;  </span><br><span class="line"><span class="number">147.</span>	         &#125;  </span><br><span class="line"><span class="number">148.</span>	         <span class="keyword">if</span>(KEY_WRITE() == <span class="number">0</span>)  <span class="comment">// 写按键检测  </span></span><br><span class="line"><span class="number">149.</span>	         &#123;  </span><br><span class="line"><span class="number">150.</span>	              Delay_Ms(<span class="number">5</span>);       <span class="comment">// 防抖  </span></span><br><span class="line"><span class="number">151.</span>	              <span class="keyword">if</span>(KEY_WRITE() == <span class="number">0</span>)  </span><br><span class="line"><span class="number">152.</span>	                &#123;  </span><br><span class="line"><span class="number">153.</span>	                          </span><br><span class="line"><span class="number">154.</span>	                        <span class="keyword">while</span>(KEY_WRITE() == <span class="number">0</span>)&#123;&#125;;  </span><br><span class="line"><span class="number">155.</span>	                        gpioc_data = ~(GPIO_ReadInputData(GPIOC) &amp; <span class="number">0x00FF</span>);  <span class="comment">// 获取拨码开关数据,上0，下1  </span></span><br><span class="line"><span class="number">156.</span>	                        write_addr = gpioc_data &amp; <span class="number">0x07</span>;                      <span class="comment">// 获得写地址  </span></span><br><span class="line"><span class="number">157.</span>	                        write_date = (gpioc_data &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>;               <span class="comment">// 写数据保存  </span></span><br><span class="line"><span class="number">158.</span>	                        Write_Data(write_addr, write_date);                  <span class="comment">// 向FPGA内存写入数据  </span></span><br><span class="line"><span class="number">159.</span>	                        GPIO_Write(GPIOB, write_date);                       <span class="comment">// 把向FPGA写入的数据显示出来  </span></span><br><span class="line"><span class="number">160.</span>	                            <span class="comment">//LED2(!LED2_DATA());  </span></span><br><span class="line"><span class="number">161.</span>	                &#125;  </span><br><span class="line"><span class="number">162.</span>	         &#125;  </span><br><span class="line"><span class="number">163.</span>	 &#125;  </span><br><span class="line"><span class="number">164.</span>	   </span><br><span class="line"><span class="number">165.</span>	   </span><br><span class="line"><span class="number">166.</span>	<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">167.	</span>&#123;  </span><br><span class="line"><span class="number">168.</span>	    Delay_Init();  </span><br><span class="line"><span class="number">169.</span>	    Led_Init();      <span class="comment">//LED灯初始化  </span></span><br><span class="line"><span class="number">170.</span>	    Sw_Init();       <span class="comment">//拨码开关初始化 按键初始化  </span></span><br><span class="line"><span class="number">171.</span>	    GPIO_FPGA_Init(); <span class="comment">// GPIOF初始化  </span></span><br><span class="line"><span class="number">172.</span>	    <span class="keyword">while</span>(<span class="number">1</span>)  </span><br><span class="line"><span class="number">173.</span>	  &#123;  </span><br><span class="line"><span class="number">174.</span>	    Key_Scan();  </span><br><span class="line"><span class="number">175.</span>	    &#125;  </span><br><span class="line"><span class="number">176.</span>	&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2-5-存储器实验结果"><a href="#2-5-存储器实验结果" class="headerlink" title="2.5 存储器实验结果"></a>2.5 存储器实验结果</h2><p>存储器实验的实验步骤如下所示：</p>
<p>（1） 在地址101写入数据1001，如图18所示；</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707235448662.png" alt=" "></p>
<center>图 18 在地址101写入数据1001</center>



<p>（2）在地址111写入数据0111，如图19所示；</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707235538431.png" alt=" "></p>
<center>图 19 在地址111写入数据0111</center>



<p>（3）在地址101读出数据1001，如图20所示；</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707235601804.png" alt=" "></p>
<center>图 20 在地址101读出数据1001</center>



<p>（4） 在地址111读出数据0111，如图21所示；</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210707235638270.png" alt=" "></p>
<center>图 21 在地址111读出数据0111</center>


<h1 id="3-实验三-外部中断实验"><a href="#3-实验三-外部中断实验" class="headerlink" title="3 实验三 外部中断实验"></a>3 实验三 外部中断实验</h1><h2 id="3-1-实验目的"><a href="#3-1-实验目的" class="headerlink" title="3.1 实验目的"></a>3.1 实验目的</h2><p>（1）掌握 NVIC 中断优先级配置。</p>
<p>（2）学会外部中断配置</p>
<h2 id="3-2-实验原理及内容"><a href="#3-2-实验原理及内容" class="headerlink" title="3.2 实验原理及内容"></a>3.2 实验原理及内容</h2><p><strong>（1）NVIC中断优先级</strong></p>
<p>NVIC 是嵌套向量中断控制器，控制着整个芯片中断相关的功能，它跟内核紧密耦合，是内核里面的一个外设。但是各个芯片厂商在设计芯片的时候会对紧密耦合，是内核里面的一个外设。但是各个芯片厂商在设计芯片的时候会对 Cortex-M4 内核里面的 NVIC 进行裁剪，把不需要的部分去掉，所以说进行裁剪，把不需要的部分去掉，所以说 STM32 的 NVIC 是 Cortex-M4 的 NVIC 的一个子集。</p>
<p>CM4 内核可以支持 256 个中断，包括 16 个内核中断和 240 个外部中断，256 级的可编程中断设置。对于 STM32F4 没有用到 CM4 内核的所有东西，只是用到了一部分，对于 STM32F40 和 41 系列共有 92 个中断，其中有 10 个内核中断和 82 个可屏蔽中断，常用的为 82 个可屏蔽中断。</p>
<p>ISER[8] 中断使能寄存器组，用来使能中断，每一位控制一个中断，由于上面已经说明了控制 82 个可屏蔽的中断，因此利用 ISER[0~2] 这三个 32 位寄存器就够了。以下的几个寄存器同理。</p>
<p>ICER[8]——中断除能寄存器组，用来消除中断。</p>
<p>ISPR[8]——中断挂起控制寄存器组，用来挂起中断。</p>
<p>ICPR[8]——中断解挂控制寄存器组，用来解除挂起。</p>
<p>IABR[8]——中断激活标志寄存器组，对应位如果为 1 则表示中断正在被执行。</p>
<p>IP[240]——中断优先级控制寄存器组，它是用来设置中断优先级的。我们只用到了 IP[0]~IP[81]，每个寄存器只用到了高 4 位，这 4 位又用来设置抢占优先级和响应优先级（有关抢占优先级和响应优先级后面会介绍到），而对于抢占优先级和响应优先级各占多少位则由 AIRCR 寄存器控制，相关设置如表1所示。</p>
<center> 表 1 中断分组</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>组</th>
<th>AIRCR[10:8]</th>
<th>bit[7:4]分配情况</th>
<th>分配结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>111</td>
<td>0：4</td>
<td>0 位抢占优先级，4 位响应优先级</td>
</tr>
<tr>
<td>1</td>
<td>110</td>
<td>1：3</td>
<td>1 位抢占优先级，3 位响应优先级</td>
</tr>
<tr>
<td>2</td>
<td>101</td>
<td>2：2</td>
<td>2 位抢占优先级，2 位响应优先级</td>
</tr>
<tr>
<td>3</td>
<td>100</td>
<td>3：1</td>
<td>3 位抢占优先级，1 位响应优先级</td>
</tr>
<tr>
<td>4</td>
<td>011</td>
<td>4：0</td>
<td>4 位抢占优先级，0 位响应优先级</td>
</tr>
</tbody>
</table>
</div>
<p>关于抢占优先级和响应优先级的理解，可以将它们简单地理解为两个级别，抢占优先级的级别要比响应优先级的级别高，简单地理解为一个为长辈的一个为晚辈的，晚辈要让着长辈，因此抢占优先级的中断可以打断响应优先级的中断，而同级别的中断就得有个先来后到的了，先来的先执行。抢占优先级与相应优先级示例，如表2所示。</p>
<center>表 2 抢占优先级与响应优先级示例</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>中断向量</th>
<th>抢占优先级</th>
<th>响应优先级</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>0</td>
<td>1</td>
<td>抢占优先级相同，响应优先级数值小的优先级高</td>
</tr>
<tr>
<td>B</td>
<td>0</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>A</td>
<td>1</td>
<td>2</td>
<td>响应优先级相同，抢占优先级数值小的优先级高</td>
</tr>
<tr>
<td>B</td>
<td>0</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>A</td>
<td>1</td>
<td>0</td>
<td>抢占优先级比响应优先级高</td>
</tr>
<tr>
<td>B</td>
<td>0</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>A</td>
<td>1</td>
<td>1</td>
<td>抢占优先级和响应优先级均相同，则中断向量编号小的先执行</td>
</tr>
<tr>
<td>B</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<p><strong>（2）外部中断</strong></p>
<p>外部中断事件控制器（EXTI）管理了控制器的 23 个中断事件线。每个中断事件线都对应有一个边沿检测器，可以实现输入信号的上升沿检测和下降沿的检测。EXTI可以实现对每个中断事件线进行单独配置，可以单独配置为中断或者事件，以及触发事件的属性。</p>
<p>EXTI功能框图如图22所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-164387137281210.png" alt=" "></p>
<center>图 22 EXTI 功能框图</center>



<p>图 22 中，在信号线上打一个斜杠并标注 23 字样表示在控制器内部类似的信号线路有 23 个，这与 EXTI 总共有 23 个中断事件线是吻合的。</p>
<p>EXTI 可分为两大部分功能，一个是产生中断，另一个是产生事件。图 22 中，线路 ①②③④⑤ 指示的电路流程是一个产生中断的线路，最终信号流入到 NVIC 控制器内。</p>
<p>编号 1 是输入线，EXTI 控制器有 23 个中断事件输入线，这些输入线可以通过寄存器设置为任意一个 GPIO，也可以是一些外设的事件，输入线一般是存在电平变化的信号。</p>
<p>编号2 是一个边沿检测电路，它会根据上升沿触发选择寄存器(EXTI_RTSR）和下降沿触发选择寄存器 (EXTI_FTSR)对应位的设置来控制信号触发。边沿检测电路以输入线作为信号输入端，如果检测到有边沿跳变就输出有效信号 1 给编号 3 电路，否则输出无效信号 0 。而 EXTI_RTSR 和 EXTI_FTSR<br>两个寄存器可以控制器需要检测哪些类型的电平跳变过程，可以是只有上升沿触发、只有下降沿触发或者上升沿和下降沿都触发。</p>
<p>编号3 电路实际就是一个或门电路，它一个输入来自编号 2 电路，另外一输入来自软件中断事件寄存器 (EXIT_SWIER) 。 EXTI_SWIER 允许我们通过程序控制就可以启动中断 事件线，这在某些地方非常有用。</p>
<p>编号 4 电路是一个与门电路，它一个输入编号 3 电路，另外一个输入来自中断屏蔽寄存器(EXTI_IMR)。与门电路要求输入都为 1 才输出 1，导致的结果如果EXTI_IMR 设置为 0 时，那不管编号 3 电路的输出信号是 1 还是 0，最终编号 4 电路输出的信号都为 0；如果 EXTI_IMR 设置为 1 时，最终编号 4 电路输出的信号才由编号 3 电路的输出信号决定，这样我们可以简单地控制 EXTI_IMR 来实现是否产生中断的目的。编号 4 电路输出的信号会被保存到挂起寄存器(EXTI_PR)内，如果确定编号 4 电路输出为 1 就会把 EXTI_PR 对应位置 1。</p>
<p>编号 5 是将 EXTI_PR 寄存器内容输出到 NVIC 内，从而实现系统中断事件控制。它是一个产生事件的线路，最终输出一个脉冲信号。</p>
<p>编号 6 电路是一个与门，它一个输入编号 3 电路，另外一个输入来自事件屏蔽寄存器(EXTI_EMR)。如果 EXTI_EMR 设置为 0 时，那不管编号 3 电路的输出信号是 1 还是 0，最终编号 6 电路输出的信号都为 0；如果 EXTI_EMR 设置为 1时，最终编号 6 电路输出的信号才由编号 3 电路的输出信号决定，这样我们可以简单的控制、EXTI_EMR 来实现是否产生事件的目的。</p>
<p>编号 7 是一个脉冲发生器电路，当它的输入端，即编号 6 电路的输出端，是一个有效信号 1 时就会产生一个脉冲；如果输入端是无效信号就不会输出脉冲。</p>
<p>编号 8 是一个脉冲信号，就是产生事件的线路最终的产物，这个脉冲信号可以给其他外设电路使用，比如定时器 TIM、模拟数字转换器 ADC 等等。产生中断线路目的是把输入信号输入到 NVIC，进一步会运行中断服务函数，实现功能，这样是软件级的。而产生事件线路目的就是传输一个脉冲信号给其他外设使用，并且是电路级别的信号传输，属于硬件级的。</p>
<p>EXTI 有 23 个中断/事件线，每个 GPIO 都可以被设置为外部中断的中断输入口，这点也是 STM32F4 的强大之处。STM32F407 的中断控制器支持 23 个外部中断/事件请求。每个中断设有状态位，每个中断/事件都有独立的触发和屏蔽设置。</p>
<p>STM32F407 的 23 个外部中断为：</p>
<ul>
<li><p>EXTI 线 0~15：对应外部 IO 口的输入中断。</p>
</li>
<li><p>EXTI 线 16：连接到 PVD 输出。</p>
</li>
<li><p>EXTI 线 17：连接到 RTC 闹钟事件。</p>
</li>
<li><p>EXTI 线 18：连接到 USB OTG FS 唤醒事件。</p>
</li>
<li><p>EXTI 线 19：连接到以太网唤醒事件。</p>
</li>
<li><p>EXTI 线 20：连接到 USB OTG HS(在 FS 中配置)唤醒事件。</p>
</li>
<li><p>EXTI 线 21：连接到 RTC 入侵和时间戳事件。</p>
</li>
<li><p>EXTI 线 22：连接到 RTC 唤醒事件。</p>
</li>
</ul>
<p>STM32F4 供 IO 口使用的中断线只有 16 个，但是 STM32F4 的 IO 口却远远不止 16 个，那么 STM32F4 是怎么把 16 个中断线和 IO 口一一对应起来的呢？于是STM32 就这样设计，GPIO 的管脚 GPIOx.0~GPIOx.15(x=A,B,C,D,E，F,G,H,I)分别对应中断线 0~15。这样每个中断线对应了最多 9 个 IO 口，以线 0 为例：它对应了 GPIOA.0、GPIOB.0、GPIOC.0、GPIOD.0、GPIOE.0、GPIOF.0、GPIOG.0、GPIOH.0、GPIOI.0。而中断线每次只能连接到 1 个 IO 口上，这样就需要通过配置来决定对应的中断线配置到哪个 GPIO 上了。GPIO 跟中断线的映射关系如图23所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210708000216511.png" alt=" "></p>
<center>图 23 GPIO 中断线映射</center>



<h2 id="3-3-完整的硬件接线图和程序流程图"><a href="#3-3-完整的硬件接线图和程序流程图" class="headerlink" title="3.3 完整的硬件接线图和程序流程图"></a>3.3 完整的硬件接线图和程序流程图</h2><p><strong>（1）硬件接线图</strong></p>
<p>完整的硬件接线图如图24所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/20210708000241500.png" alt=" "></p>
<center>图 24 外部中断实验硬件接线图</center>



<p><strong>（2）程序流程图</strong></p>
<p>程序流程图如图25所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-16438713605706.png" alt=" "></p>
<center>图 25 外部中断实验程序流程图</center>



<h2 id="3-4-外部中断实验源代码程序"><a href="#3-4-外部中断实验源代码程序" class="headerlink" title="3.4 外部中断实验源代码程序"></a>3.4 外部中断实验源代码程序</h2><p><strong>（1）main.c</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="comment">/******************************************************************** </span></span><br><span class="line"><span class="comment">2.	实验名称：数码管动态扫描实验 </span></span><br><span class="line"><span class="comment">3.	 </span></span><br><span class="line"><span class="comment">4.	硬件模块：计算机原理应用实验箱 </span></span><br><span class="line"><span class="comment">5.	 </span></span><br><span class="line"><span class="comment">6.	硬件接线：ARM P11接口---------数码管 P4接口  </span></span><br><span class="line"><span class="comment">7.	            PC0--------SI </span></span><br><span class="line"><span class="comment">8.	            PC1--------RCK </span></span><br><span class="line"><span class="comment">9.	            PC2--------SCK </span></span><br><span class="line"><span class="comment">10.	            PC3--------A </span></span><br><span class="line"><span class="comment">11.	            PC4--------B </span></span><br><span class="line"><span class="comment">12.	            PC5--------C </span></span><br><span class="line"><span class="comment">13.	         ARM P10接口----------按键 P1接口 </span></span><br><span class="line"><span class="comment">14.	             PB8--------KEY1_N </span></span><br><span class="line"><span class="comment">15.	             PB11-------KEY2_N   </span></span><br><span class="line"><span class="comment">16.	          ARM P12接口-----------LED P2接口 </span></span><br><span class="line"><span class="comment">17.	             PF0~PF7------LED1~LED8       </span></span><br><span class="line"><span class="comment">18.	         注：可用20P排线直连P11、P4接口，直连P10、P1接口，直连P12、P2接口。 </span></span><br><span class="line"><span class="comment">19.	                     </span></span><br><span class="line"><span class="comment">20.	实验现象：数码管上显示数字0~7，可通过按键检测或者外部中断触发流水灯。 </span></span><br><span class="line"><span class="comment">21.	************************************************************************/</span>  </span><br><span class="line"><span class="number">22.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stm32f4xx.h&quot;</span>  </span></span><br><span class="line"><span class="number">23.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span>  </span></span><br><span class="line"><span class="number">24.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;smg.h&quot;</span>  </span></span><br><span class="line"><span class="number">25.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;led.h&quot;</span>  </span></span><br><span class="line"><span class="number">26.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;exti.h&quot;</span>  </span></span><br><span class="line"><span class="number">27.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;my_timer.h&quot;</span>  </span></span><br><span class="line"><span class="number">28.</span>	  </span><br><span class="line"><span class="number">29.</span>	<span class="meta">#<span class="meta-keyword">define</span> KEY  GPIO_ReadInputDataBit(GPIOB, GPIO_Pin_11)  </span></span><br><span class="line"><span class="number">30.</span>	   </span><br><span class="line"><span class="number">31.</span>	<span class="function"><span class="keyword">void</span> <span class="title">Key_Hardware_Init</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">32.	</span>&#123;  </span><br><span class="line"><span class="number">33.</span>	    GPIO_InitTypeDef GPIO_TypeDefStructure;  </span><br><span class="line"><span class="number">34.</span>	  </span><br><span class="line"><span class="number">35.</span>	    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOB, ENABLE);   <span class="comment">//开启中断输入端口时钟  </span></span><br><span class="line"><span class="number">36.</span>	  </span><br><span class="line"><span class="number">37.</span>	    GPIO_TypeDefStructure.GPIO_Pin = GPIO_Pin_11;  </span><br><span class="line"><span class="number">38.</span>	    GPIO_TypeDefStructure.GPIO_Mode = GPIO_Mode_IN;    <span class="comment">//通用输入模式  </span></span><br><span class="line"><span class="number">39.</span>	    GPIO_TypeDefStructure.GPIO_PuPd = GPIO_PuPd_UP;      <span class="comment">//上拉  </span></span><br><span class="line"><span class="number">40.</span>	    GPIO_Init(GPIOB, &amp;GPIO_TypeDefStructure);  </span><br><span class="line"><span class="number">41.</span>	&#125;  </span><br><span class="line"><span class="number">42.</span>	  </span><br><span class="line"><span class="number">43.</span>	  </span><br><span class="line"><span class="number">44.</span>	<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">45.	</span>&#123;  </span><br><span class="line"><span class="number">46.</span>	    <span class="keyword">uint8_t</span> i;  </span><br><span class="line"><span class="number">47.</span>	    <span class="keyword">uint16_t</span> cont = <span class="number">0</span>;  </span><br><span class="line"><span class="number">48.</span>	    NVIC_PriorityGroupConfig(NVIC_PriorityGroup_0);  </span><br><span class="line"><span class="number">49.</span>	    Delay_Init();             <span class="comment">//延时初始化  </span></span><br><span class="line"><span class="number">50.</span>	    EXTI_Configure();         <span class="comment">//外部中断初始化   </span></span><br><span class="line"><span class="number">51.</span>	    TIM1_Configure(<span class="number">999</span>, <span class="number">167</span>);  <span class="comment">//定时器初始化  1ms  </span></span><br><span class="line"><span class="number">52.</span>	    SMG_Init();               <span class="comment">//数码管初始化  </span></span><br><span class="line"><span class="number">53.</span>	    LED_Hardware_Init();       <span class="comment">//LED灯初始化   </span></span><br><span class="line"><span class="number">54.</span>	    Key_Hardware_Init();       <span class="comment">//按键检测初始化  </span></span><br><span class="line"><span class="number">55.</span>	       </span><br><span class="line"><span class="number">56.</span>	    <span class="keyword">while</span>(<span class="number">1</span>)  </span><br><span class="line"><span class="number">57.</span>	    &#123;  </span><br><span class="line"><span class="number">58.</span>	        cont++;  </span><br><span class="line"><span class="number">59.</span>	        <span class="keyword">if</span>(cont &gt;= <span class="number">500</span>)  </span><br><span class="line"><span class="number">60.</span>	        &#123;  </span><br><span class="line"><span class="number">61.</span>	            cont = <span class="number">0</span>;  </span><br><span class="line"><span class="number">62.</span>	            SMG_Sele(i);  <span class="comment">//数码管显示数据  </span></span><br><span class="line"><span class="number">63.</span>	            <span class="keyword">if</span>(i == <span class="number">5</span>)    <span class="comment">//数码管数据显示到第五位时按键检测  </span></span><br><span class="line"><span class="number">64.</span>	            &#123;  </span><br><span class="line"><span class="number">65.</span>	                <span class="keyword">if</span>(!KEY)  </span><br><span class="line"><span class="number">66.</span>	                &#123;  </span><br><span class="line"><span class="number">67.</span>	                    Delay_Ms(<span class="number">10</span>);  </span><br><span class="line"><span class="number">68.</span>	                    <span class="keyword">if</span>(!KEY)  </span><br><span class="line"><span class="number">69.</span>	                    &#123;  </span><br><span class="line"><span class="number">70.</span>	                        <span class="keyword">while</span>(!KEY)&#123;&#125;;  </span><br><span class="line"><span class="number">71.</span>	                        led_flow_flag = <span class="number">1</span>;   <span class="comment">//开启流水灯  </span></span><br><span class="line"><span class="number">72.</span>	                    &#125;  </span><br><span class="line"><span class="number">73.</span>	                &#125;  </span><br><span class="line"><span class="number">74.</span>	            &#125;  </span><br><span class="line"><span class="number">75.</span>	            i++;  </span><br><span class="line"><span class="number">76.</span>	            i &amp;= <span class="number">0x07</span>;  </span><br><span class="line"><span class="number">77.</span>	      </span><br><span class="line"><span class="number">78.</span>	        &#125;  </span><br><span class="line"><span class="number">79.</span>	        Delay_Ms(<span class="number">1</span>);   <span class="comment">//需要明显效果时打开延时   </span></span><br><span class="line"><span class="number">80.</span>	        LED_Flow();     </span><br><span class="line"><span class="number">81.</span>	    &#125;  </span><br><span class="line"><span class="number">82.</span>	&#125;  </span><br><span class="line"><span class="number">83.</span>	  </span><br><span class="line"><span class="number">84.</span>	<span class="comment">//end file  </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>（2）led.c</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;led.h&quot;</span>  </span></span><br><span class="line"><span class="number">2.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span>  </span></span><br><span class="line"><span class="number">3.</span>	  </span><br><span class="line"><span class="number">4.</span>	<span class="keyword">uint8_t</span> led_flow_flag = <span class="number">0</span>;    <span class="comment">//流水灯开启标志  </span></span><br><span class="line"><span class="number">5.</span>	  </span><br><span class="line"><span class="number">6.</span>	<span class="comment">/********************************************************** </span></span><br><span class="line"><span class="comment">7.	*功  能：LED初始化 </span></span><br><span class="line"><span class="comment">8.	*参  数：无 </span></span><br><span class="line"><span class="comment">9.	*返回值：无 </span></span><br><span class="line"><span class="comment">10.	**********************************************************/</span>  </span><br><span class="line"><span class="number">11.</span>	<span class="function"><span class="keyword">void</span> <span class="title">LED_Hardware_Init</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">12.	</span>&#123;  </span><br><span class="line"><span class="number">13.</span>	    GPIO_InitTypeDef   GPIO_InitStructure;  </span><br><span class="line"><span class="number">14.</span>	  </span><br><span class="line"><span class="number">15.</span>	    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOF, ENABLE);   <span class="comment">//开启GPIOF的时钟  </span></span><br><span class="line"><span class="number">16.</span>	  </span><br><span class="line"><span class="number">17.</span>	    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_All;  </span><br><span class="line"><span class="number">18.</span>	  </span><br><span class="line"><span class="number">19.</span>	    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;          <span class="comment">//输出模式  </span></span><br><span class="line"><span class="number">20.</span>	    GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;         <span class="comment">//推挽输出   </span></span><br><span class="line"><span class="number">21.</span>	    GPIO_InitStructure.GPIO_Speed = GPIO_Medium_Speed;     <span class="comment">//速率25MHz  </span></span><br><span class="line"><span class="number">22.</span>	    GPIO_Init(GPIOF, &amp;GPIO_InitStructure);  </span><br><span class="line"><span class="number">23.</span>	  </span><br><span class="line"><span class="number">24.</span>	    GPIO_Write(GPIOF, <span class="number">0x0000</span>);  </span><br><span class="line"><span class="number">25.</span>	&#125;  </span><br><span class="line"><span class="number">26.</span>	  </span><br><span class="line"><span class="number">27.</span>	  </span><br><span class="line"><span class="number">28.</span>	<span class="function"><span class="keyword">void</span> <span class="title">LED_Flow</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">29.	</span>&#123;  </span><br><span class="line"><span class="number">30.</span>	    <span class="keyword">static</span> <span class="keyword">uint8_t</span> cont;  </span><br><span class="line"><span class="number">31.</span>	    <span class="keyword">static</span> <span class="keyword">uint16_t</span> led_data;  </span><br><span class="line"><span class="number">32.</span>	    <span class="keyword">if</span>(led_flow_flag == <span class="number">1</span>)  </span><br><span class="line"><span class="number">33.</span>	    &#123;  </span><br><span class="line"><span class="number">34.</span>	        led_data = <span class="number">1</span>&lt;&lt;cont;           </span><br><span class="line"><span class="number">35.</span>	        LED_SET(led_data);   </span><br><span class="line"><span class="number">36.</span>	        Delay_Ms(<span class="number">100</span>);  </span><br><span class="line"><span class="number">37.</span>	        cont++;  </span><br><span class="line"><span class="number">38.</span>	        cont &amp;= <span class="number">0x07</span>;    <span class="comment">//大于7后清零  </span></span><br><span class="line"><span class="number">39.</span>	    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(led_flow_flag == <span class="number">2</span>)  </span><br><span class="line"><span class="number">40.</span>	    &#123;  </span><br><span class="line"><span class="number">41.</span>	        LED_SET(<span class="number">0xff00</span>);  </span><br><span class="line"><span class="number">42.</span>	        Delay_Ms(<span class="number">300</span>);  </span><br><span class="line"><span class="number">43.</span>	        LED_SET(<span class="number">0x0000</span>);  </span><br><span class="line"><span class="number">44.</span>	        Delay_Ms(<span class="number">300</span>);  </span><br><span class="line"><span class="number">45.</span>	    &#125;  </span><br><span class="line"><span class="number">46.</span>	&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>（3）exti.c</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;exti.h&quot;</span>  </span></span><br><span class="line"><span class="number">2.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;led.h&quot;</span>  </span></span><br><span class="line"><span class="number">3.</span>	  </span><br><span class="line"><span class="number">4.</span>	<span class="comment">/******************************* </span></span><br><span class="line"><span class="comment">5.	功  能：外部中断配置 </span></span><br><span class="line"><span class="comment">6.	参  数：无 </span></span><br><span class="line"><span class="comment">7.	返回值：无 </span></span><br><span class="line"><span class="comment">8.	*******************************/</span>  </span><br><span class="line"><span class="number">9.</span>	<span class="function"><span class="keyword">void</span> <span class="title">EXTI_Configure</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">10.	</span>&#123;  </span><br><span class="line"><span class="number">11.</span>	        GPIO_InitTypeDef GPIO_TypeDefStructure;  </span><br><span class="line"><span class="number">12.</span>	        EXTI_InitTypeDef EXTI_TypeDefStructure;  </span><br><span class="line"><span class="number">13.</span>	        NVIC_InitTypeDef NVIC_TypeDefStructure;  </span><br><span class="line"><span class="number">14.</span>	          </span><br><span class="line"><span class="number">15.</span>	        <span class="comment">//开启中断输入端口时钟  </span></span><br><span class="line"><span class="number">16.</span>	        RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOB, ENABLE);  </span><br><span class="line"><span class="number">17.</span>	          </span><br><span class="line"><span class="number">18.</span>	        <span class="comment">//开启外部中断时钟  </span></span><br><span class="line"><span class="number">19.</span>	        RCC_APB2PeriphClockCmd(RCC_APB2Periph_SYSCFG, ENABLE);  </span><br><span class="line"><span class="number">20.</span>	          </span><br><span class="line"><span class="number">21.</span>	        GPIO_TypeDefStructure.GPIO_Pin = GPIO_Pin_8;  </span><br><span class="line"><span class="number">22.</span>	        GPIO_TypeDefStructure.GPIO_Mode = GPIO_Mode_IN;     <span class="comment">//通用输入模式  </span></span><br><span class="line"><span class="number">23.</span>	        GPIO_TypeDefStructure.GPIO_PuPd = GPIO_PuPd_UP;       <span class="comment">//上拉  </span></span><br><span class="line"><span class="number">24.</span>	        GPIO_Init(GPIOB, &amp;GPIO_TypeDefStructure);  </span><br><span class="line"><span class="number">25.</span>	  </span><br><span class="line"><span class="number">26.</span>	        <span class="comment">//中断线关联  </span></span><br><span class="line"><span class="number">27.</span>	        SYSCFG_EXTILineConfig(EXTI_PortSourceGPIOB, EXTI_PinSource8);  </span><br><span class="line"><span class="number">28.</span>	          </span><br><span class="line"><span class="number">29.</span>	        EXTI_TypeDefStructure.EXTI_Line = EXTI_Line8;  </span><br><span class="line"><span class="number">30.</span>	        EXTI_TypeDefStructure.EXTI_Mode = EXTI_Mode_Interrupt;  </span><br><span class="line"><span class="number">31.</span>	        EXTI_TypeDefStructure.EXTI_Trigger = EXTI_Trigger_Falling;<span class="comment">//下降沿触发  </span></span><br><span class="line"><span class="number">32.</span>	        EXTI_TypeDefStructure.EXTI_LineCmd = ENABLE;  </span><br><span class="line"><span class="number">33.</span>	        EXTI_Init(&amp;EXTI_TypeDefStructure);  </span><br><span class="line"><span class="number">34.</span>	          </span><br><span class="line"><span class="number">35.</span>	        <span class="comment">//EXT9_5_IRQn中断向量优先级设置  </span></span><br><span class="line"><span class="number">36.</span>	        NVIC_TypeDefStructure.NVIC_IRQChannel = EXTI9_5_IRQn;  </span><br><span class="line"><span class="number">37.</span>	        NVIC_TypeDefStructure.NVIC_IRQChannelPreemptionPriority = <span class="number">0</span>;  </span><br><span class="line"><span class="number">38.</span>	        NVIC_TypeDefStructure.NVIC_IRQChannelSubPriority = <span class="number">7</span>;  </span><br><span class="line"><span class="number">39.</span>	        NVIC_TypeDefStructure.NVIC_IRQChannelCmd = ENABLE;  </span><br><span class="line"><span class="number">40.</span>	        NVIC_Init(&amp;NVIC_TypeDefStructure);  </span><br><span class="line"><span class="number">41.</span>	&#125;  </span><br><span class="line"><span class="number">42.</span>	  </span><br><span class="line"><span class="number">43.</span>	  </span><br><span class="line"><span class="number">44.</span>	  </span><br><span class="line"><span class="number">45.</span>	<span class="comment">/******************************* </span></span><br><span class="line"><span class="comment">46.	功  能：外部中断服务函数 </span></span><br><span class="line"><span class="comment">47.	参  数：无 </span></span><br><span class="line"><span class="comment">48.	返回值：无 </span></span><br><span class="line"><span class="comment">49.	*******************************/</span>  </span><br><span class="line"><span class="number">50.</span>	<span class="function"><span class="keyword">void</span> <span class="title">EXTI9_5_IRQHandler</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">51.	</span>&#123;  </span><br><span class="line"><span class="number">52.</span>	    <span class="keyword">if</span>(EXTI_GetITStatus(EXTI_Line8))  </span><br><span class="line"><span class="number">53.</span>	    &#123;  </span><br><span class="line"><span class="number">54.</span>	        <span class="keyword">if</span>(GPIO_ReadInputDataBit(GPIOB, GPIO_Pin_8) == <span class="number">0</span>)  </span><br><span class="line"><span class="number">55.</span>	        &#123;  </span><br><span class="line"><span class="number">56.</span>	            led_flow_flag = <span class="number">2</span>;  </span><br><span class="line"><span class="number">57.</span>	            EXTI_ClearITPendingBit(EXTI_Line8);  </span><br><span class="line"><span class="number">58.</span>	        &#125;  </span><br><span class="line"><span class="number">59.</span>	    &#125;  </span><br><span class="line"><span class="number">60.</span>	&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>（4）smg.c</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;smg.h&quot;</span>  </span></span><br><span class="line"><span class="number">2.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span>  </span></span><br><span class="line"><span class="number">3.</span>	  </span><br><span class="line"><span class="number">4.</span>	<span class="comment">/******************************* </span></span><br><span class="line"><span class="comment">5.	功  能：数码管端口初始化 </span></span><br><span class="line"><span class="comment">6.	参  数：无 </span></span><br><span class="line"><span class="comment">7.	返回值：无 </span></span><br><span class="line"><span class="comment">8.	*******************************/</span>  </span><br><span class="line"><span class="number">9.</span>	<span class="function"><span class="keyword">void</span> <span class="title">SMG_Init</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">10.	</span>&#123;  </span><br><span class="line"><span class="number">11.</span>	    GPIO_InitTypeDef   GPIO_InitStructure;  </span><br><span class="line"><span class="number">12.</span>	  </span><br><span class="line"><span class="number">13.</span>	    RCC_AHB1PeriphClockCmd(SMG_RCC_GPIO, ENABLE);       <span class="comment">//开启GPIOC的时钟  </span></span><br><span class="line"><span class="number">14.</span>	  </span><br><span class="line"><span class="number">15.</span>	    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2   </span><br><span class="line"><span class="number">16.</span>	                                                | GPIO_Pin_3 | GPIO_Pin_4 | GPIO_Pin_5;  </span><br><span class="line"><span class="number">17.</span>	    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;       <span class="comment">//输出模式  </span></span><br><span class="line"><span class="number">18.</span>	    GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;      <span class="comment">//推挽输出   </span></span><br><span class="line"><span class="number">19.</span>	    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;   <span class="comment">//速度50MHz  </span></span><br><span class="line"><span class="number">20.</span>	    GPIO_Init(SMG_GPIO, &amp;GPIO_InitStructure);  </span><br><span class="line"><span class="number">21.</span>	&#125;  </span><br><span class="line"><span class="number">22.</span>	  </span><br><span class="line"><span class="number">23.</span>	<span class="comment">/******************************* </span></span><br><span class="line"><span class="comment">24.	功  能：HC595发送数据 </span></span><br><span class="line"><span class="comment">25.	参  数：dat    数据 </span></span><br><span class="line"><span class="comment">26.	返回值：无 </span></span><br><span class="line"><span class="comment">27.	*******************************/</span>  </span><br><span class="line"><span class="number">28.</span>	<span class="function"><span class="keyword">void</span> <span class="title">HC595_Send</span><span class="params">(<span class="keyword">uint8_t</span> dat)</span>  </span></span><br><span class="line"><span class="function">29.	</span>&#123;  </span><br><span class="line"><span class="number">30.</span>	    <span class="keyword">uint8_t</span> dat_buf = <span class="number">0</span>, i;  </span><br><span class="line"><span class="number">31.</span>	    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)  </span><br><span class="line"><span class="number">32.</span>	    &#123;  </span><br><span class="line"><span class="number">33.</span>	        dat_buf = dat &amp; <span class="number">0x80</span>;  </span><br><span class="line"><span class="number">34.</span>	        <span class="keyword">if</span> (dat_buf)      <span class="comment">//输出1bit数据  </span></span><br><span class="line"><span class="number">35.</span>	        &#123;  </span><br><span class="line"><span class="number">36.</span>	          HC595_SI(<span class="number">1</span>);    <span class="comment">//将74HC595串行数据输入引脚设置为高电平  </span></span><br><span class="line"><span class="number">37.</span>	        &#125;  </span><br><span class="line"><span class="number">38.</span>	        <span class="keyword">else</span>  </span><br><span class="line"><span class="number">39.</span>	        &#123;  </span><br><span class="line"><span class="number">40.</span>	          HC595_SI(<span class="number">0</span>);    <span class="comment">//将74HC595串行数据输入引脚设置为低电平  </span></span><br><span class="line"><span class="number">41.</span>	        &#125;  </span><br><span class="line"><span class="number">42.</span>	        HC595_SCK(<span class="number">0</span>);  </span><br><span class="line"><span class="number">43.</span>	        Delay_Us(<span class="number">1</span>);  </span><br><span class="line"><span class="number">44.</span>	        HC595_SCK(<span class="number">1</span>);  </span><br><span class="line"><span class="number">45.</span>	        Delay_Us(<span class="number">1</span>);  </span><br><span class="line"><span class="number">46.</span>	        dat &lt;&lt;= <span class="number">1</span>;  </span><br><span class="line"><span class="number">47.</span>	    &#125;  </span><br><span class="line"><span class="number">48.</span>	    HC595_RCK(<span class="number">0</span>);  </span><br><span class="line"><span class="number">49.</span>	    Delay_Us(<span class="number">3</span>);  </span><br><span class="line"><span class="number">50.</span>	    HC595_RCK(<span class="number">1</span>);  </span><br><span class="line"><span class="number">51.</span>	&#125;  </span><br><span class="line"><span class="number">52.</span>	  </span><br><span class="line"><span class="number">53.</span>	  </span><br><span class="line"><span class="number">54.</span>	  </span><br><span class="line"><span class="number">55.</span>	<span class="comment">//显示的数字数组，依次为0,1,..,7  </span></span><br><span class="line"><span class="number">56.</span>	<span class="keyword">uint8_t</span> digivalue[] = &#123;<span class="number">0x3F</span>, <span class="number">0x06</span>, <span class="number">0x5B</span>, <span class="number">0x4F</span>, <span class="number">0x66</span>, <span class="number">0x6D</span>, <span class="number">0x7D</span>,  <span class="number">0x07</span>&#125;;   </span><br><span class="line"><span class="number">57.</span>	  </span><br><span class="line"><span class="number">58.</span>	<span class="comment">/******************************* </span></span><br><span class="line"><span class="comment">59.	功  能：数码管位段控制 </span></span><br><span class="line"><span class="comment">60.	参  数：index   对应的数码管 </span></span><br><span class="line"><span class="comment">61.	返回值：无 </span></span><br><span class="line"><span class="comment">62.	*******************************/</span>  </span><br><span class="line"><span class="number">63.</span>	<span class="function"><span class="keyword">void</span> <span class="title">SMG_Sele</span><span class="params">(<span class="keyword">uint8_t</span> index)</span>  </span></span><br><span class="line"><span class="function">64.	</span>&#123;  </span><br><span class="line"><span class="number">65.</span>	   HC595_Send(digivalue[index]);       </span><br><span class="line"><span class="number">66.</span>	&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>（5）my_timer.c</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;my_timer.h&quot;</span>  </span></span><br><span class="line"><span class="number">2.</span>	<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;led.h&quot;</span>  </span></span><br><span class="line"><span class="number">3.</span>	  </span><br><span class="line"><span class="number">4.</span>	<span class="comment">/****************************************** </span></span><br><span class="line"><span class="comment">5.	功  能：定时器1初始化 </span></span><br><span class="line"><span class="comment">6.	参  数：arr  定时器初值  psc  预分频系数 </span></span><br><span class="line"><span class="comment">7.	返回值：无 </span></span><br><span class="line"><span class="comment">8.	******************************************/</span>  </span><br><span class="line"><span class="number">9.</span>	<span class="function"><span class="keyword">void</span> <span class="title">TIM1_Configure</span><span class="params">(<span class="keyword">uint32_t</span> arr,<span class="keyword">uint16_t</span> psc)</span>  </span></span><br><span class="line"><span class="function">10.	</span>&#123;  </span><br><span class="line"><span class="number">11.</span>	    TIM_TimeBaseInitTypeDef TIM_TimeBaseStructure;  </span><br><span class="line"><span class="number">12.</span>	    NVIC_InitTypeDef NVIC_InitStructure;  </span><br><span class="line"><span class="number">13.</span>	      </span><br><span class="line"><span class="number">14.</span>	    RCC_APB2PeriphClockCmd(RCC_APB2Periph_TIM1,ENABLE);  </span><br><span class="line"><span class="number">15.</span>	      </span><br><span class="line"><span class="number">16.</span>	    <span class="comment">//定时器初值  </span></span><br><span class="line"><span class="number">17.</span>	    TIM_TimeBaseStructure.TIM_Period = arr;  </span><br><span class="line"><span class="number">18.</span>	    <span class="comment">//预分配系数  </span></span><br><span class="line"><span class="number">19.</span>	    TIM_TimeBaseStructure.TIM_Prescaler = psc;  </span><br><span class="line"><span class="number">20.</span>	    <span class="comment">//向上计数  </span></span><br><span class="line"><span class="number">21.</span>	    TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;  </span><br><span class="line"><span class="number">22.</span>	    <span class="comment">//时钟分频因子  </span></span><br><span class="line"><span class="number">23.</span>	    TIM_TimeBaseStructure.TIM_ClockDivision = TIM_CKD_DIV1;  </span><br><span class="line"><span class="number">24.</span>	    <span class="comment">//重复计数次数  </span></span><br><span class="line"><span class="number">25.</span>	    TIM_TimeBaseStructure.TIM_RepetitionCounter = <span class="number">0</span>;  </span><br><span class="line"><span class="number">26.</span>	      </span><br><span class="line"><span class="number">27.</span>	    TIM_TimeBaseInit(TIM1,&amp;TIM_TimeBaseStructure);  </span><br><span class="line"><span class="number">28.</span>	      </span><br><span class="line"><span class="number">29.</span>	    <span class="comment">//选择中断向量  </span></span><br><span class="line"><span class="number">30.</span>	    NVIC_InitStructure.NVIC_IRQChannel = TIM1_UP_TIM10_IRQn;  </span><br><span class="line"><span class="number">31.</span>	    <span class="comment">//抢占优先级  </span></span><br><span class="line"><span class="number">32.</span>	    NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = <span class="number">0</span>;  </span><br><span class="line"><span class="number">33.</span>	    <span class="comment">//响应优先级  </span></span><br><span class="line"><span class="number">34.</span>	    NVIC_InitStructure.NVIC_IRQChannelSubPriority = <span class="number">6</span>;  </span><br><span class="line"><span class="number">35.</span>	    <span class="comment">//使能中断向量  </span></span><br><span class="line"><span class="number">36.</span>	    NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;  </span><br><span class="line"><span class="number">37.</span>	    NVIC_Init(&amp;NVIC_InitStructure);  </span><br><span class="line"><span class="number">38.</span>	      </span><br><span class="line"><span class="number">39.</span>	    <span class="comment">//TIM1中断使能  </span></span><br><span class="line"><span class="number">40.</span>	    TIM_ITConfig(TIM1,TIM_IT_Update,ENABLE);  </span><br><span class="line"><span class="number">41.</span>	    <span class="comment">//TIM1使能  </span></span><br><span class="line"><span class="number">42.</span>	    TIM_Cmd(TIM1,ENABLE);  </span><br><span class="line"><span class="number">43.</span>	&#125;  </span><br><span class="line"><span class="number">44.</span>	  </span><br><span class="line"><span class="number">45.</span>	<span class="comment">/****************************************** </span></span><br><span class="line"><span class="comment">46.	功  能：定时器1中断服务函数 </span></span><br><span class="line"><span class="comment">47.	参  数：无 </span></span><br><span class="line"><span class="comment">48.	返回值：无 </span></span><br><span class="line"><span class="comment">49.	******************************************/</span>  </span><br><span class="line"><span class="number">50.</span>	<span class="function"><span class="keyword">void</span> <span class="title">TIM1_UP_TIM10_IRQHandler</span><span class="params">(<span class="keyword">void</span>)</span>  </span></span><br><span class="line"><span class="function">51.	</span>&#123;  </span><br><span class="line"><span class="number">52.</span>	    <span class="keyword">static</span> <span class="keyword">uint16_t</span> cont_time = <span class="number">0</span>;  </span><br><span class="line"><span class="number">53.</span>	    <span class="keyword">if</span>(TIM_GetITStatus(TIM1, TIM_IT_Update) == SET)  </span><br><span class="line"><span class="number">54.</span>	    &#123;  </span><br><span class="line"><span class="number">55.</span>	       <span class="keyword">if</span>(led_flow_flag)  </span><br><span class="line"><span class="number">56.</span>	       &#123;  </span><br><span class="line"><span class="number">57.</span>	          cont_time++;  </span><br><span class="line"><span class="number">58.</span>	          <span class="keyword">if</span>(cont_time &gt;= <span class="number">5000</span>)  <span class="comment">// 闪烁时间  </span></span><br><span class="line"><span class="number">59.</span>	          &#123;  </span><br><span class="line"><span class="number">60.</span>	             cont_time = <span class="number">0</span>;  </span><br><span class="line"><span class="number">61.</span>	             led_flow_flag = <span class="number">0</span>;  </span><br><span class="line"><span class="number">62.</span>	          &#125;  </span><br><span class="line"><span class="number">63.</span>	       &#125;  </span><br><span class="line"><span class="number">64.</span>	       TIM_ClearITPendingBit(TIM1,TIM_IT_Update);  </span><br><span class="line"><span class="number">65.</span>	    &#125;  </span><br><span class="line"><span class="number">66.</span>	&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3-5-外部中断实验结果"><a href="#3-5-外部中断实验结果" class="headerlink" title="3.5 外部中断实验结果"></a>3.5 外部中断实验结果</h2><p>外部中断实验的实验步骤如下所示：</p>
<p>(1) 正常状态下，数码管由0到7不断循环显示数字，如图26所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-16438713524454.png" alt=" "></p>
<center>图 26 数码管由0到7不断循环显示数字</center>



<p>(2) 按下按键1后，数码管保持当前显示不动，交通灯闪烁，如图27所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70-16438713495682.png" alt=" "></p>
<center>图 27 数码管保持当前显示不动，交通灯闪烁</center>


<p>(3) 当数码管显示5时，按下按键2后，数码管保持当前显示不动，流水灯启动，如图28所示。</p>
<p><img src="/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgxNzMwOQ==,size_16,color_FFFFFF,t_70.png" alt=" "></p>
<center>图 28 数码管保持当前显示不动，流水灯启动</center>


<h1 id="4-实验总结"><a href="#4-实验总结" class="headerlink" title="4 实验总结"></a>4 实验总结</h1><h2 id="4-1-ARM相关驱动程序的安装"><a href="#4-1-ARM相关驱动程序的安装" class="headerlink" title="4.1 ARM相关驱动程序的安装"></a>4.1 ARM相关驱动程序的安装</h2><p>由于授课教师提供的FTP服务器中只含有ST-LINK的驱动安装包，而本次实验需要使用的是J-LINK驱动安装，因此需要自行在网络上下载J-LINK的驱动安装包，Keil才可以读取到硬件。</p>
<h2 id="4-2-Keil注册机的下载"><a href="#4-2-Keil注册机的下载" class="headerlink" title="4.2 Keil注册机的下载"></a>4.2 Keil注册机的下载</h2><p>由于FTP服务器中的Keil注册机已经在2021年的今天不再适用，故需要通过网络自行搜索下载最新版破解到2032年的Keil注册机。此外，Keil注册机可能会被杀毒软件误杀，且无法在QQ群中进行共享，因此最好的方式还是从网络上下载。</p>
<h2 id="4-3-USB-Blaster驱动的安装"><a href="#4-3-USB-Blaster驱动的安装" class="headerlink" title="4.3 USB-Blaster驱动的安装"></a>4.3 USB-Blaster驱动的安装</h2><p>由于版本的变化，在先前数电实验中使用的Quartus 20.1版本所对应的USB Blaster驱动无法与课程要求的Quartus 13.1版本相适应，且电脑无法自动安装驱动。故需要打开设备管理器手动在Quartus 13.1安装文件中的drivers文件夹添加USB Blaster驱动。</p>
<h2 id="4-4-Keil软件的烧录问题"><a href="#4-4-Keil软件的烧录问题" class="headerlink" title="4.4 Keil软件的烧录问题"></a>4.4 Keil软件的烧录问题</h2><p>在编程过程中遇到了点击烧录但开发板的效果没有变化的情况。这是因为在烧录之前没有进行ranslate再进行build操作，然后再进行烧录。</p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://lgc0208.github.io/2021/07/08/%E6%B0%B4%E7%81%AF%E3%80%81%E5%AD%98%E5%82%A8%E5%99%A8%E3%80%81%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Verilog/" rel="tag">Verilog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B1%87%E7%BC%96/" rel="tag">汇编</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2021/07/10/Java%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            基于 Tomcat 的  Java 本地服务器读取 SQL Server 中的数据及账号密码核对
          
        </div>
      </a>
    
    
      <a href="/2021/06/10/%E4%BF%A1%E6%81%AF%E9%97%A8%E6%88%B7%E9%80%9A%E7%9F%A5%E6%9F%A5%E8%AF%A2%E7%B3%BB%E7%BB%9F/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">基于微信小程序的北邮信息门户通知查询系统</div>
      </a>
    
  </nav>

   
<!-- valine评论 -->
<div id="vcomments-box">
  <div id="vcomments"></div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.staticfile.org/valine/1.4.16/Valine.min.js"></script>
<script>
  new Valine({
    el: "#vcomments",
    app_id: "9Vh791RymMFcXDMd7WLX5uK3-gzGzoHsz",
    app_key: "3F3lWYfhMRuo1jPHArn44zkC",
    path: window.location.pathname,
    avatar: "monsterid",
    placeholder: "给我的文章加点评论吧~",
    recordIP: true,
  });
  const infoEle = document.querySelector("#vcomments .info");
  if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
    infoEle.childNodes.forEach(function (item) {
      item.parentNode.removeChild(item);
    });
  }
</script>
<style>
  #vcomments-box {
    padding: 5px 30px;
  }

  @media screen and (max-width: 800px) {
    #vcomments-box {
      padding: 5px 0px;
    }
  }

  #vcomments-box #vcomments {
    background-color: #fff;
  }

  .v .vlist .vcard .vh {
    padding-right: 20px;
  }

  .v .vlist .vcard {
    padding-left: 10px;
  }
</style>

 
   
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2022
        <i class="ri-heart-fill heart_icon"></i> lgc0208@foxmail.com
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/sun-side.svg" alt="梦"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/photos">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/zhifubao.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/weixin.png">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.staticfile.org/mathjax/2.7.7/MathJax.js"></script>
<script src="https://cdn.staticfile.org/mathjax/2.7.7/config/TeX-AMS-MML_HTMLorMML-full.js"></script>
<script>
  var ayerConfig = {
    mathjax: true,
  };
</script>

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->
 
<script src="/js/clickBoom2.js"></script>
 
<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=1294952823# 网易云分享的音乐ID(更换音乐请更改此配置项)&auto=1&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    

  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>

</html>